<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First-Use Name Highlighter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for highlighted spans */
        .name-highlight {
            padding: 2px 4px;
            border-radius: 4px;
            color: #1f2937; /* A dark gray for good contrast */
        }
        /* Style for the output area to preserve formatting */
        #output {
            white-space: pre-wrap; /* Preserves whitespace and newlines */
            word-wrap: break-word; /* Breaks long words to prevent overflow */
            line-height: 1.6;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">NER-Powered Name Highlighter</h1>
            <p class="mt-2 text-lg text-gray-600">Highlights the first use of a full name (bold) and subsequent uses of the last name using an NLP model.</p>
            <p class="mt-1 text-sm text-gray-500">This helps verify correct name usage patterns in your text.</p>
        </header>

        <main>
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                <label for="inputText" class="block text-md font-semibold text-gray-700 mb-2">Input Text</label>
                <textarea id="inputText" rows="12" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="Paste your article, report, or story here..."></textarea>
                <button id="analyze-btn" onclick="processText()" disabled class="mt-4 w-full bg-indigo-400 text-white font-bold py-3 px-4 rounded-lg cursor-not-allowed transition-colors duration-300">
                    Loading NLP Model...
                </button>
            </div>

            <div id="results-container" class="mt-8 bg-white p-6 rounded-xl shadow-md border border-gray-200 hidden">
                 <div class="flex justify-between items-center mb-4 border-b pb-3 border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800">Highlighted Result</h2>
                    <div id="legend" class="flex flex-wrap gap-x-4 gap-y-2 justify-end"></div>
                 </div>
                <div id="output" class="text-base text-gray-700"></div>
            </div>
        </main>

        <footer class="text-center mt-12 text-sm text-gray-400">
            <p>Powered by compromise.js NLP.</p>
        </footer>
    </div>
    
    <!-- Embedded compromise.js library to avoid CDN loading issues -->
    <script>!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).compromise=t()}(this,(function(){"use strict";const e=e=>e.toLowerCase().trim(),t=(e,t)=>Object.keys(e).reduce((s,o)=>{let r=e[o];return"string"==typeof r&&(r=r.replace(/%t/g,t)),s[o]=r,s},{}),s=(e,t)=>e.map(e=>"string"==typeof e?e.replace(/%t/g,t):e),o={one:e=>/(?:[aeiouy]d$)/.test(e)||/(?:[aeiouy]l$)/.test(e),two:e=>/([aeiouy])\1l$/.test(e),three:e=>/[aeiouy]c$/.test(e)},r={infinitive:"infinitive",presentTense:"presentTense",pastTense:"pastTense",gerund:"gerund",actor:"actor",participle:"participle"},n={};r.adjective="adjective",r.adverb="adverb",r.comparative="comparative",r.superlative="superlative",r.noun="noun",r.singular="singular",r.plural="plural";const a=r,i=Object.keys(a).reduce((e,t)=>(e[a[t]]=t,e),{});n.conjugations=i,n.declensions={adjective:"adjective",adverb:"adverb",comparative:"comparative",superlative:"superlative",noun:"noun",singular:"singular",plural:"plural"};const c={person:"people",man:"men",woman:"women",goy:"goyim",radius:"radii",nucleus:"nuclei",focus:"foci",fungus:"fungi",appendix:"appendices",index:"indices",stimulus:"stimuli",alumnus:"alumni",syllabus:"syllabi",larva:"larvae",formula:"formulae",vertebra:"vertebrae",phenomenon:"phenomena",criterion:"criteria",chateau:"chateaux",plateau:"plateaux",beau:"beaux",tableau:"tableaux",personnel:"personnel",child:"children",circus:"circuses",sex:"sexes",mouse:"mice",ox:"oxen",louse:"lice",tooth:"teeth",goose:"geese",foot:"feet",die:"dice",genus:"genera",graffito:"graffiti",opus:"opera",axis:"axes",crisis:"crises",diagnosis:"diagnoses",synopsis:"synopses",thesis:"theses",parenthesis:"parentheses",analysis:"analyses",basis:"bases",neurosis:"neuroses",oasis:"oases",ellipsis:"ellipses",matrix:"matrices",codex:"codices",vortex:"vortices"},l=Object.keys(c).reduce((e,t)=>(e[c[t]]=t,e),{}),p={i:"me",she:"her",he:"him",we:"us",they:"them"},d=Object.keys(p).reduce((e,t)=>(e[p[t]]=t,e),{}),u=/([aeiou]|\b)y$/,h=/y$/,m=/h$/,f=/ss$/,y=/s$/,g=/x$/,x=/[aeiou]s$/,b=/[aeiou]$/,C=/(..*){1}/,v=/x$/,w=/s$/,T=/[aeiou]s$/;var O={toSingular:function(t){let r=e(t);if("data"===r||"media"===r||"criteria"===r||"phenomena"===r)return t;if(l.hasOwnProperty(r))return l[r];if(r.length<=3)return t;if(/ies$/.test(r)){let e=r.replace(/ies$/,"y");if(C.test(e))return e}if(/s$/.test(r)&&!/ss$/.test(r)&&!/us$/.test(r)){if(/men$/.test(r))return r.replace(/men$/,"man");if(/nuses$/i.test(r))return r.replace(/nuses$/,"nus");if(/ice$/i.test(r)&&o.one(r))return r.replace(/ice$/,"ouse");if(/ice$/i.test(r)&&o.two(r))return r.replace(/ice$/,"ouse");if(/ice$/i.test(r)&&o.three(r))return r.replace(/ice$/,"ouse");if(/uses$/i.test(r))return r.replace(/uses$/,"us");if(/hi$/i.test(r))return r.replace(/hi$/,"us");if(/zoa$/i.test(r))return r.replace(/zoa$/,"zoon");if(/ata$/i.test(r))return r.replace(/ata$/,"atum");if(/lia$/i.test(r))return r.replace(/lia$/,"lium");if(/genera$/i.test(r))return r.replace(/genera$/,"genus");if(/a$/i.test(r))return r.replace(/a$/,"um");if(/ia$/i.test(r))return r.replace(/ia$/,"ium");if(/ae$/i.test(r))return r.replace(/ae$/,"a");if(/i$/i.test(r))return r.replace(/i$/,"us");if(/es$/i.test(r)){if(/ches$/i.test(r))return r.replace(/ches$/,"ch");if(/shes$/i.test(r))return r.replace(/shes$/,"sh");if(/mnes$/i.test(r))return r.replace(/mnes$/,"mna");if(/ses$/i.test(r)){if(/heses$/i.test(r))return r.replace(/heses$/,"sis");if(/xeses$/i.test(r))return r.replace(/xeses$/,"xis");if(/meses$/i.test(r))return r.replace(/meses$/,"sis");if(/gnoses$/i.test(r))return r.replace(/gnoses$/,"sis");if(/lapses$/i.test(r))return r.replace(/lapses$/,"psis");if(/aliases$/i.test(r))return r.replace(/aliases$/,"alias")}if(/theses$/i.test(r))return r.replace(/theses$/,"thesis");if(/aves$/i.test(r))return r.replace(/aves$/,"afe");if(/ives$/i.test(r))return r.replace(/ives$/,"ife");if(/ves$/i.test(r))return r.replace(/ves$/,"f");if(/zzes$/i.test(r))return r.replace(/zzes$/,"z");if(/xes$/i.test(r))return r.replace(/xes$/,"x");if(r.length>3)return r.replace(/es$/,"")}if(r.length>3&&/s$/.test(r)&&!x.test(r)&&!b.test(r.slice(0,-1)))return r.slice(0,-1)}return t},toPlural:function(t){let s=e(t);if(s.length<=2)return t;if(c.hasOwnProperty(s))return c[s];if(u.test(s))return s.replace(h,"ies");if(m.test(s))return s+"es";if(f.test(s))return s+"es";if(v.test(s))return s+"es";if(w.test(s)&&!T.test(s)&&s.length>3)return t;if(y.test(s))return t;let o=s.replace(y,"");return/man$/.test(o)?o.replace(/man$/,"men"):s+"s"}};const S={irregulars:c,plural:{rules:[[/aer$/i,""],[/ire$/i,""],[/alk$/i,""],[/ff$/i,"s"],[/gg$/i,"s"],[/ch$/i,"es"],[/sh$/i,"es"],[/ss$/i,"es"],[/us$/i,"es"],[/x$/i,"es"],[/s$/i,"s"],[/$/i,"s"]],exceptions:{"plus":"plusses","bus":"buses",thesaurus:"thesauruses",circus:"circuses",promise:"promises",torus:"toruses",virus:"viruses",alias:"aliases",prospectus:"prospectuses",consensus:"consensuses"}},singular:{rules:[[/shes$/i,"sh"],[/ches$/i,"ch"],[/ses$/i,"s"],[/xes$/i,"x"],[/ices$/i,"ix"],[/uses$/i,"us"],[/s$/i,""],[/$/i,""]],exceptions:{plusses:"plus",buses:"bus",thesauruses:"thesaurus",circuses:"circus",promises:"promise",toruses:"torus",viruses:"virus",aliases:"alias",prospectuses:"prospectus",consensuses:"consensus"}}};S.plural.rules=S.plural.rules.map(e=>("string"==typeof e[1]&&(e[1]=t(O.plural.rules,e[1])),e)),S.singular.rules=S.singular.rules.map(e=>("string"==typeof e[1]&&(e[1]=t(O.singular.rules,e[1])),e));const k=S,D=Object.keys(k.irregulars).reduce((e,t)=>(e[k.irregulars[t]]=t,e),{});k.uncountable={"hertz":!0,species:!0,series:!0,sheep:!0,fish:!0,aircraft:!0,bass:!0,bison:!0,buffalo:!0,cod:!0,flounder:!0,mackerel:!0,moose:!0,salmon:!0,trout:!0,advice:!0,information:!0,knowledge:!0,trouble:!0,enjoyment:!0,fun:!0,recreation:!0,relaxation:!0,meat:!0,rice:!0,bread:!0,cake:!0,coffee:!0,food:!0,fruit:!0,pasta:!0,water:!0,oil:!0,grass:!0,love:!0,sadness:!0,happiness:!0,music:!0,art:!0,literature:!0,software:!0,hardware:!0,news:!0,media:!0,money:!0,currency:!0,cash:!0,electricity:!0,gas:!0,power:!0,energy:!0,equipment:!0,machinery:!0,furniture:!0,mail:!0,luggage:!0,baggage:!0,clothing:!0,jewelry:!0,graffiti:!0,police:!0,scissors:!0,shorts:!0,pants:!0,trousers:!0,glasses:!0,goggles:!0,jeans:!0,pantyhose:!0,pajamas:!0,tweezers:!0,mathematics:!0,physics:!0,economics:!0,athletics:!0,linguistics:!0,politics:!0,gymnastics:!0,acrobatics:!0,electronics:!0,ethics:!0,statistics:!0,celcius:!0,fahrenheit:!0,kelvin:!0,zucchini:!0,spaghetti:!0,debris:!0,gravel:!0,information:!0,kudos:!0,news:!0,plankton:!0,research:!0,loggorhea:!0,misinformation:!0,barracks:!0,gallows:!0,headquarters:!0,shambles:!0,whereabouts:!0,foliage:!0,syrup:!0,molasses:!0,bacon:!0,cauliflower:!0,macaroni:!0,aisle:!0,lettuce:!0,jelly:!0,jello:!0,mayonnaise:!0,quinoa:!0,corn:!0,asparagus:!0,broccoli:!0,bok:!0,bina:!0,kohlrabi:!0,oolong:!0};for(let e in k.uncountable)/s$/.test(e)&&(k.uncountable[O.toSingular(e)]=!0);const L={toPlural:function(e){if(k.uncountable[e])return e;if(k.irregulars[e])return k.irregulars[e];for(let t=0;t<k.plural.rules.length;t+=1){let s=k.plural.rules[t];if(s[0].test(e))return e.replace(s[0],s[1])}return e},toSingular:function(e){if(k.uncountable[e])return e;if(D[e])return D[e];for(let t=0;t<k.singular.rules.length;t+=1){let s=k.singular.rules[t];if(s[0].test(e))return e.replace(s[0],s[1])}return e}},N=L,I=function(e,t,s,o){this.word=e||"",this.tags=t||[],this.normal=s||"",this.implicit=o||""};I.prototype.clone=function(){return new I(this.word,this.tags.slice(),this.normal,this.implicit)};var A={toInfinitive:function(e){return e},toPresent:function(e){return e},toPast:function(e){return e},toGerund:function(e){return e}},P=/ss$/,M=/s$/,F=/[aeiou]s$/,R=/y$/,E=/([aeiou])y$/,z=/h$/,U=/z$/,B=/([aeiou])([mlgp])$/,K=/(e|i)e$/,G=/[aeiou]$/,W=/[aeiou][aeiou]$/,$=/[aeiou].$/;var V={toInfinitive:function(t){let s=e(t);if("be"===s||"been"===s||"am"===s||"is"===s||"are"===s||"was"===s||"were"===s)return"be";if(A.hasOwnProperty(s))return A[s];if(s.length<=3)return t;if(/ied$/.test(s)){let e=s.replace(/ied$/,"y");return C.test(e)?e:t}if(/e?d$/.test(s)){let e=s.replace(/d$/,""),o=s.replace(/ed$/,"");if(B.test(o)){let e=o.replace(/([mlgp])$/,"$1e");return e}if(/(ee|ie|oe|ue)d$/i.test(s))return e;if(/([aeiou])\1d$/i.test(s)&&!K.test(o))return o;if(/le?d$/i.test(s))return e;if(/[^aeiou]ed$/i.test(s)&&!/ered$/i.test(s))return o;if(/ered$/i.test(o)&&G.test(o.slice(0,-3)))return o.replace(/red$/,"r");if(o.length>4&&G.test(o)&&W.test(o.slice(0,2)))return o;if($.test(o)&&G.test(o))return o}if(/ing$/i.test(s)){let e=s.replace(/ing$/,"");if(B.test(e)){let t=e.replace(/([mlgp])$/,"$1e");return t}if(/(ee|ie|oe|ue)ing$/i.test(s))return e;if(/([aeiou])\1ing$/i.test(s))return s.slice(0,-4);if(/[^aeiou]ing$/i.test(s)&&e.length>4)return e;if(/ling$/i.test(s))return e+"le";if(e.length>4&&G.test(e)&&!G.test(e.slice(0,-1)))return e+"e";if(e.length<4)return t;if($.test(e)&&G.test(e))return e+"e"}return t},toGerund:function(t){let s=e(t);if(A.hasOwnProperty(s))return s+"ing";if("be"===s)return"being";if(/e$/.test(s)&&!/ee$/.test(s)&&!/ie$/.test(s)&&!/oe$/.test(s))return s.replace(/e$/,"ing");if(/n$/.test(s)&&G.test(s.slice(0,1)))return s+"ning";let o=s.slice(-1);if("t"===o&&G.test(s.slice(-2,-1)))return s+"ting";if("l"===o&&G.test(s.slice(-2,-1)))return s+"ling";if("g"===o&&G.test(s.slice(-2,-1)))return s+"ging";if("p"===o&&G.test(s.slice(-2,-1)))return s+"ping";if("b"===o&&G.test(s.slice(-2,-1)))return s+"bing";if("m"===o&&G.test(s.slice(-2,-1)))return s+"mming";return s+"ing"},toPastTense:function(t){let s=e(t);if(A.hasOwnProperty(s))return s;if("be"===s)return"was";if(/ed$/.test(s))return s;if(/e$/.test(s))return s+"d";if(E.test(s))return s.replace(R,"ied");if(R.test(s))return t;let o=s.slice(-1);if("t"===o&&G.test(s.slice(-2,-1)))return s+"ted";if("p"===o&&G.test(s.slice(-2,-1)))return s+"ped";return s+"ed"},toPresentTense:function(t){let s=e(t);return A.hasOwnProperty(s)?s:/([a-z]*)men$/.test(s)?s.replace(/men$/,"man"):/s$/.test(s)?s:E.test(s)?s.replace(R,"ies"):R.test(s)?t:z.test(s)?s+"es":U.test(s)?s+"es":P.test(s)?s+"es":M.test(s)&&!F.test(s)&&s.length>3?s:s+"s"}},j=/!$/,q=/^'/,H=/'$/,Z=/"$/,J=/\.$/,Q=/[,:]$/,X=/\?$/,Y=/\(/,ee=/\)$/,te=/-$/,se=/%$/,oe=/[a-z]/,re=/([0-9])(st|nd|rd|th)$/,ne=/^(1|2|3)rd$/,ae=e=>(e.endsWith("teen")||e.endsWith("tys"))&&oe.test(e),ie=/^'/,ce=/^"/,le=/ ?\.\.\. ?$/,pe=/[a-z0-9]\-[a-z0-9]/,de=/([a-z\u00C0-\u00FF])(s|'s|'|`|‘|’)$/,ue=/([0-9]+)s$/;const he=(e,t)=>{if(!e)return[];let s,o,r=e.split(/(\S+)/);r=r.filter(e=>e);for(let e=0;e<r.length;e+=1){let n=r[e];if(n.length>1&&!le.test(n)){if(s=n.match(se))n=n.replace(se,""),r.splice(e+1,0,"%");else if(s=n.match(j))n=n.replace(j,""),r.splice(e+1,0,"!");else if(s=n.match(X))n=n.replace(X,""),r.splice(e+1,0,"?");else if(s=n.match(Y))!function(e,t,s){let o=e.match(Y);if(o&&o.index>0){let r=e.substring(0,o.index);let n=e.substring(o.index,e.length);t[s]=r,t.splice(s+1,0,n)}}(n,r,e);else if(s=n.match(ee))!function(e,t,s){let o=e.match(ee);if(o&&o.index!==e.length-1){let r=e.substring(0,o.index+1);let n=e.substring(o.index+1,e.length);t[s]=r,t.splice(s+1,0,n)}else t[s]=e.replace(ee,""),t.splice(s+1,0,")")}(n,r,e);else if(s=n.match(te))r[e]=n.replace(te,"");else if(o=n.match(de))t.contractions.hasOwnProperty(o[2])?(r[e]=o[1],r.splice(e+1,0,t.contractions[o[2]])):r[e]=o[1];else if(o=n.match(J))n=n.replace(J,"."),/\b(mr|mrs|ms|dr|sr|jr|sgt|capt|prof|esq|gov|rev|st|inc|corp|ltd)\b/i.test(n)||(r[e]=n.replace(J,""),r.splice(e+1,0,"."));else if(o=n.match(Q))r[e]=n.replace(Q,""),r.splice(e+1,0,n.substr(n.length-1));else if(o=n.match(ue))r[e]=o[1];else if(s=n.match(q))r[e]=n.replace(q,""),r.splice(e,0,"'");else if(s=n.match(H))r[e]=n.replace(H,""),r.splice(e+1,0,"'");else if(s=n.match(Z))r[e]=n.replace(Z,""),r.splice(e+1,0,'"');else if(t.honorifics[n.toLowerCase().replace(/\./g,"")])r[e]=r[e]+r[e+1],r[e+1]=null;else if(pe.test(n)){let e=n.split(pe);e[0]&&e[1]&&(r.splice(e,1,e[0],"-",e[1]),e=null)}r[e]!==n&&(e-=1)}r=r.filter(e=>e)}return r.map(e=>e.trim()).filter(e=>e)},me=(e,t)=>{let s=0;const o=()=>{if(s>=e.length)return null;let o=e[s];s+=1,o.terms.forEach(e=>{e.offset={index:t.length,start:t.length,length:e.word.length},t.push(e)});let r=o.terms.length;if(s<e.length&&!o.post&&r>0){let e=t[t.length-1];e.word&&(e.post=""),o.post=""}return r>0?r:o()};return o()},fe=(e,t)=>{let s=[];e.docs.forEach(e=>{s.push({terms:e,pre:t.pre,post:t.post})}),t.docs=s};var ye={split:function(e){let t=this;t.docs.forEach(e=>{let s=he(e[0].word,t.world);e.length=0,s.forEach((t,s)=>{e[s]=new I(t)})});let s=me(t.docs,t.terms);null!==s&&t.dirty&&t.compute("lexicon")},contract:function(){let e=this.world;return this.terms.forEach((t,s)=>{let o=e.contractions[t.normal];if(o){let e=he(o,this.world);e=e.map(e=>new I(e)),this.terms.splice(s,1,...e)}}),this}};const ge={FromAdjective:{toNoun:e=>null,toVerb:e=>null},FromGerund:{toNoun:e=>null,toAdjective:e=>null},FromNoun:{toAdjective:e=>null,toVerb:e=>null},FromVerb:{toNoun:e=>"string"==typeof e?e+"er":null,toAdjective:e=>"string"==typeof e?e+"able":null,toGerund:e=>"string"==typeof e?V.toGerund(e):null}};const xe={toPlural:N.toPlural,toSingular:N.toSingular},be={toInfinitive:V.toInfinitive,toGerund:V.toGerund,toPastTense:V.toPastTense,toPresentTense:V.toPresentTense},Ce=e=>(e||"").replace(/^./,e=>e.toUpperCase());var ve=Object.assign({},xe,be,{toAdjective:(e,t)=>{if(t.isA("Noun"))return ge.FromNoun.toAdjective(e,t);if(t.isA("Verb"))return ge.FromVerb.toAdjective(e,t)},toNoun:(e,t)=>{if(t.isA("Adjective"))return ge.FromAdjective.toNoun(e,t);if(t.isA("Verb"))return ge.FromVerb.toNoun(e,t)},toVerb:(e,t)=>{if(t.isA("Adjective"))return ge.FromAdjective.toVerb(e,t);if(t.isA("Noun"))return ge.FromNoun.toVerb(e,t)},toGerund:(e,t)=>t.isA("Verb")?V.toGerund(e,t):null,toTitleCase:e=>{return e.replace(/\w\S*/g,e=>Ce(e))},toCamelCase:e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),toUpperCase:e=>e.toUpperCase(),toLowerCase:e=>e.toLowerCase(),toSentenceCase:e=>{let t=!0;return e.replace(/(\.|\?|!)\s*(\w)/g,(e,s,o)=>s+" "+o.toUpperCase()).replace(/[a-z]/i,e=>{if(t)return t=!1,e.toUpperCase();return e})}});const we=(e,t)=>{let s,o={};for(let r=0;r<e.length;r++){s=e[r].normal.replace(/'s$/,"");let n=Object.keys(t).find(e=>new RegExp(e).test(s));n&&(o[n]=!0)}return Object.keys(o)},Te=(e,t)=>{for(let s=0;s<e.length;s++){if(!e[s])return!1;let o=Object.keys(t).find(t=>new RegExp(t).test(e[s]));if(!o||!t[o])return!1}return!0},Oe=(e,t,s)=>{let o={start:t,end:s};if(t>s)return o.start=s,o.end=t,o;let r=[];return e.forEach(e=>{e.start>=o.start&&e.end<=o.end&&r.push(e)}),r},Se=(e,t)=>{let s=Object.assign({},e);return s.start-=t,s.end-=t,s},ke=(e,t)=>{let s;for(let o=0;o<e.length;o++){let r=e[o];if(r.start>=t.start&&r.end<=t.end){s=r;break}}return s},De=(e,t,s,o)=>{let r=e.length;for(let n=0;n<t.length;n++){let[a,i]=t[n];if(o){if(s[i]){let t=s[i].slice(0,o).join(" ");e.push({start:r,end:r+a.length,word:a,match:t})}}else if(s[i]&&s[i][0]){e.push({start:r,end:r+a.length,word:a,match:s[i][0]})}}};const Le={pre:function(e){return e.slice(0,-1).map(e=>e.normal)},post:function(e){return e.slice(1).map(e=>e.normal)},all:function(e){return e.map(e=>e.normal)},first:function(e){return[e[0].normal]},last:function(e){return[e[e.length-1].normal]}},Ne=e=>{let t={};return e.forEach(e=>{Object.keys(e).forEach(s=>{t[s]=e[s]})}),t};var Ie=(e,t)=>{let s={start:null,end:null};e.forEach((e,o)=>{null===s.start&&t.includes(e.normal)&&(s.start=o),null!==s.start&&null===s.end&&!t.includes(e.normal)&&(s.end=o)}),null!==s.start&&null===s.end&&(s.end=e.length);let o=[];if(null!==s.start){let t=e.slice(s.start,s.end);o.push(t)}return o};const Ae=e=>(e.parent=this,Object.defineProperty(e,"world",{get:()=>this.world}),Object.defineProperty(e,"pool",{get:()=>this.pool}),e),Pe=(e,t,s,o)=>{let r;if(!s||"string"!=typeof s)return[];if(s=s.replace(/^\^/,""),s=s.replace(/\$$/,""),s=s.replace(/\s+/g," "),/\(.*\)/.test(s)){let n=/\((.+?)\)/.exec(s);return s=n[1].split("|").map(s=>{let r=t.match(s);return e.lookAhead||e.lookBehind?r:(o&&(r=r.not(o)),r)}),s=[].concat.apply([],s),s}return r=t.match(s),e.lookAhead||e.lookBehind?r:(o&&(r=r.not(o)),r)},Me={optional:e=>`(${e})?`,oneOrMore:e=>`(${e})+`,anyAmount:e=>`(${e})*`,anything:()=>".*",word:()=>"\\w+",titleCase:()=>"[A-Z][a-z]+"},Fe=e=>{let t,s;let o=e.match(/^(#\w+)/);if(o.found)return t=o.get(0).termList[0].tags[0],t;let r=e.match(/^(\w+)/);if(r.found){s=r.get(0).termList[0].normal;let e=Object.keys(Me).find(e=>e===s);if(e)return Me[e]()}};const Re=(e,t)=>{if("string"==typeof e)return e;if("function"==typeof e)return e(t)},Ee=e=>e.map(e=>`(${e.join(" && ")})`),ze=e=>{let t=[],s=!1,o=!1,r=!1;for(let n=0;n<e.length;n++){let a=e[n];t.push(a),"."===a?(s=!1,r=!1,o=!1):"?"===a?o=!0:!0===s||!0===r?(s=!1,r=!1,o&&(o=!1)):!0===o?(o=!1):"+"===a?s=!0:"*"===a&&(r=!0)}return t},Ue=e=>{let t=e.split(/ /g);t=ze(t);let s=[];for(let e=0;e<t.length;e++){let o=t[e],r=".";if("."!==o){let e=o.split(/&/g);e=e.map(e=>e.trim()),r=`(${e.join(" && ")})`,t[e+1]&&("?"===t[e+1]?r+="?":"+"===t[e+1]?r+="+":"*"===t[e+1]&&(r+="*"))}s.push(r)}return s.join(" ")};const Be=e=>{let t=[];return e.forEach(e=>{e.start>0&&e.end<e.doc.length-1&&t.push(e)}),t},Ke=e=>{let t=[];return e.docs.forEach(e=>{e[0]&&(e.length-1>e[0].start&&t.push([e[0]]))}),t},Ge=e=>{let t=[];return e.docs.forEach(s=>{let o=s.length-1;o>0&&s[o]&&(0!==s[o].start&&t.push([s[o]]))}),t};const We=e=>{let t=[];return e.docs.forEach(s=>{s[0]&&!1===s[0].start&&t.push(s)}),t},$e=e=>{let t=[];return e.docs.forEach(s=>{s[0]&&!1===s[s.length-1].end&&t.push(s)}),t};const Ve=e=>{let t=e.filter(e=>void 0!==e);return t.length>0&&t[0].length>0?t.flat():[]},je=(e,t)=>{let s={groups:[]};for(let o=0;o<e.length;o++){let r=e[o];if(r&&r.length>0){let n,a=r[0].start,i=r[r.length-1].end;if("string"==typeof t)n={group:t};else if("function"==typeof t)n={group:t(r)};else if("object"==typeof t){let e=Object.keys(t).find(e=>r.full.has(e));e&&(n=t[e])}n&&(n.start=a,n.end=i,n.term=r,s.groups.push(n))}}return s};const qe=e=>e.map(e=>e.word).join(" "),He=(e,t)=>{let s,o=0;if(void 0===t)s=o=e.docs.length-1;else{if("string"==typeof t){let s=e.match(t);s.found?(o=e.docs.indexOf(s.docs[0]))>-1&&(o-=1):o=e.docs.length-1}else"number"==typeof t?o=t:e.docs[t]&&(o=t)}o<0&&(o=0);let r=e.docs.slice(0,o);return e.fromDoc(r)},Ze=(e,t)=>{let s,o=0;if(void 0===t)s=o=e.docs.length-1;else{if("string"==typeof t){let s=e.match(t);s.found?(o=e.docs.indexOf(s.docs[0]))>-1&&(o+=1):o=0}else"number"==typeof t?o=t:e.docs[t]&&(o=t)}o>=e.docs.length&&(o=e.docs.length-1),o<0&&(o=0);let r=e.docs.slice(o);return e.fromDoc(r)},Je=e=>{let t=[];return e.forEach(e=>e.terms.forEach(e=>{t.push(e.normal)})),t.join(" ")},Qe=(e,t,s)=>{let o=e.map(e=>{if("."===e)return".";let o=[];return e.forEach(t=>{let r=s(t);r&&o.push(r)}),0===o.length?null:`(${o.join("|")})`});return o=o.filter(e=>e),t=t.fromDoc(t.toDoc(o.join(" ")))},Xe=(e,t,s)=>{let o=e.split(" ");return o=o.filter(e=>e),o=o.map(e=>`.? ${e} .?`),t.match(`(${o.join("|")})`)},Ye=(e,t,s)=>{let o=e.all();return o=o.map(e=>e.normal),t.match(`!(${o.join("|")})`)},et=function(e){return e.termList().map(e=>e.word)};et.text=e=>e.termList().map(e=>e.text).join(""),et.normal=e=>e.termList().map(e=>e.normal).join(""),et.implicit=e=>e.termList().map(e=>e.implicit).join(""),et.machine=e=>e.termList().map(e=>e.machine||e.normal).join(""),et.root=e=>e.termList().map(e=>e.root||e.normal).join("");const tt=e=>e.docs.map(e=>e.map(e=>e.json({text:!1,normal:!1}))),st=(e,t)=>{if("function"==typeof t){t(e);for(let s=0;s<e.docs.length;s++)for(let o=0;o<e.docs[s].length;o++)t(e.docs[s][o])}if("string"==typeof t){e.tag(t);for(let s=0;s<e.docs.length;s++)for(let o=0;o<e.docs[s].length;o++){let r=e.docs[s][o];r.tags.add(t)}}return e};const ot=(e,t)=>{let s=Object.assign({},t);return s.pointer=e,new this.constructor(s.docs,this,s)},rt=(e,t,s)=>{s.docs=e.docs.filter(e=>{let o=!1;if(t.startsWith("!"))return o=e.some(e=>e.tags.has(t.slice(1))),!o;if(t.startsWith("#"))return e.some(e=>e.tags.has(t.slice(1)));{let s=t.split(/\|/);for(let t=0;t<s.length;t+=1)if(e.some(e=>e.normal===s[t]||e.implicit===s[t]||e.word===s[t])){o=!0;break}return o}})};var nt={get:function(e){let t=this;return"number"==typeof e?(t=t.eq(e),t.found?t:t.from([])):"string"==typeof e?t.match(e):void 0},eq:function(e){return this.from(this.docs[e])},first:function(e){return e=e||1,this.from(this.docs.slice(0,e))},last:function(e){return e=e||1,this.from(this.docs.slice(-e))},slice:function(e,t){let s=this.docs.slice(e,t);return this.from(s)},word:function(e){let t=[];return this.docs.forEach(s=>t=t.concat(s[e])),this.from(t,e)},term:function(e){let t=[];return this.docs.forEach(s=>{s.length>e&&(t=t.concat(s[e]))}),this.from(t,e)},match:function(e,t){return this.splitOn(e).eq(t)},split:function(e){return this.splitOn(e)},splitAfter:function(e){return this.splitOn(e,"after")},splitBefore:function(e){return this.splitOn(e,"before")},join:function(){},union:function(e){let t=this.docs.concat(e.docs),s=[];return t.forEach(e=>{if(!e||!e[0]||null==e[0].start)return;let o=!1;s.forEach(t=>{t[0]&&e[0].start===t[0].start&&t[0].length===e[0].length&&(o=!0)}),!1===o&&s.push(e)}),this.from(s)},intersection:function(e){let t=this.docs,s=e.docs,o=[];t.forEach(e=>{if(!e||!e[0]||null==e[0].start)return;let t=!1;s.forEach(s=>{s[0]&&e[0].start===s[0].start&&s[0].length===e[0].length&&(t=!0)}),!0===t&&o.push(e)}),s.forEach(e=>{if(!e||!e[0]||null==e[0].start)return;let s=!1;t.forEach(t=>{t[0]&&e[0].start===t[0].start&&t[0].length===e[0].length&&(s=!0)}),!0===s&&o.push(e)});let r=[];return o.forEach(e=>{if(!e||!e[0]||null==e[0].start)return;let t=!1;r.forEach(s=>{s[0]&&e[0].start===s[0].start&&s[0].length===e[0].length&&(t=!0)}),!1===t&&r.push(e)}),this.from(r)},complement:function(e){let t=this.pointer,s=this.all();return s=s.not(this),e.found&&s.not(e),s.setPointer(t)},diff:function(e){let t=this.pointer,s=this.docs,o=e.docs,r=[],n=[];return s.forEach(e=>{let t=!1;o.forEach(s=>{s[0]&&e[0].start===s[0].start&&s[0].length===e[0].length&&(t=!0)}),!1===t&&r.push(e)}),o.forEach(e=>{let s=!1;t.forEach(t=>{t[0]&&e[0].start===s[0].start&&s[0].length===e[0].length&&(s=!0)}),!1===s&&n.push(e)}),this.from(r.concat(n)).setPointer(t)},filter:function(e){let t=this.docs.filter(t=>e(this.from(t)));return this.from(t)},forEach:function(e){return this.docs.forEach((t,s)=>{let o=this.from(t);o.index=s,e(o)}),this},map:function(e){let t=[];return this.docs.forEach((s,o)=>{let r=this.from(s);r.index=o;let n=e(r);"string"==typeof n?t=t.concat(n):"object"==typeof n&&null!==n&&(t=t.concat(n.docs))}),this.from(t)},find:function(e){for(let t=0;t<this.docs.length;t+=1){let s=this.from(this.docs[t]);if(e(s))return s}return this.from([])}};nt.terms=nt.word,nt.clauses=function(){let e=[];return this.list.forEach(e=>e.clauses().forEach(t=>e.push(t))),this.from(e)},nt.if=function(e){let t=this.match(e);return t.found?t:this},nt.ifNo=function(e){return this.match(e).found?this.from([]):this},nt.has=function(e){return this.match(e).found};const at=Object.keys(nt);var it={pointer:function(e){let t=this.docs;if(!t.length||!t[0]||!t[0].length)return[];let[s,o,r,n]=e,a=[];if(void 0===s)return t;if("number"==typeof s){let e=t[s];void 0===o&&a.push(e)}else if("string"==typeof s)for(let e=0;e<t.length;e++){let r=t[e];if(void 0===o){let e=r.findIndex(e=>e.normal===s);if(-1!==e)a.push(r)}else a.push(r)}return a.filter(e=>e)},update:function(e){let t=Object.assign({},this.pointer);return this.docs.forEach((s,o)=>{e[0]===o&&(t=[o,e[1],e[2],e[3]])}),t},addPointer:function(e,t){let[s,o,r,n]=e,a=t.length,i=t.docs.length;return[s+i,o,r,n]},from:function(e,t,s){let o=Object.assign({},s);return"number"==typeof t&&(o.pointer=[this.docs.indexOf(e[0].doc),e[0].start,e.length]),new this.constructor(e,this,o)},fromDoc:function(e,t){let s=Object.assign({},this.pointer),o=Object.assign({},t,{pointer:s});return new this.constructor(e,this,o)},toDoc:function(e){let t=he(e,this.world);return t.map(e=>new I(e))},all:function(){return this.parent.all()},none:function(){return this.from([])},termList:function(){let e=[];return this.docs.forEach(t=>t.forEach(t=>e.push(t))),e},fullSentence:function(){let e=this.all();if(!this.docs[0]||!this.docs[0][0])return e;let t=this.docs[0][0].start;return e.slice(0,t)},parent:function(){return this.parent},parents:function(e){let t=this,s=[];for(let o=0;o<50;o+=1)if(t=t.parent,s.push(t),!t.parent)return e?s[s.length-1]:this.from(s);return e?s[s.length-1]:this.from(s)},tagger:function(){return this.world.tagger.apply(this.world,arguments)},looks:function(e){if(!e)return this.all();if("string"==typeof e){let t=this.match(e);return this.from(t.docs)}return this.filter(e)},is:function(e){return this.looks(e)},clone:function(e){let t=this.docs.map(e=>e.map(e=>e.clone()));return e&&(t=t.map(e=>{let t=e[0].doc;return Object.assign([],e,{parent:t})})),this.fromDoc(t,{pointer:this.pointer})}};it.list=it,it.clauses=function(){let e=[];return this.list.forEach(e=>e.clauses().forEach(t=>e.push(t))),this.from(e)},it.match=function(e,t,s){let o=this.methods.one.parse(e,this.world.model),r=[];return this.list.forEach(e=>{let t=this.methods.one.match(e.docs,o);r=r.concat(t)}),s?this.from(r[s]):this.from(r)},it.not=function(e){let t=this.match(e);if(0===t.length)return this;let s=[];this.docs.forEach(e=>{let o=!1;t.docs.forEach(t=>{t[0].start===e[0].start&&t[t.length-1].end-1===e[e.length-1].end-1&&(o=!0)}),!1===o&&s.push(e)});let o=this.pointer;return o&&(o[0]-=1,o[0]<0&&(o=null)),this.from(s,o)},it.json=function(e){e=e||{};let t={text:et.text(this),normal:et.normal(this),terms:tt(this)};return e.text||delete t.text,e.normal||delete t.normal,e.terms||delete t.terms,e.tags&&this.docs[0]&&(t.tags=this.docs[0][0].tags),e.implicit&&this.docs[0]&&(t.implicit=this.docs[0][0].implicit),e.whitespace&&this.docs[0]&&(t.pre=this.docs[0][0].pre,t.post=this.docs[0][0].post),e.offset&&(t.offset=this.offset()),1===this.docs.length&&1===this.docs[0].length&&Object.assign(t,this.docs[0][0].json(e)),t};const ct={};ct.splitOn=function(e,t){let s=this.match(e);if(!s.found)return this;let o=this.docs,r=[],n=0;return s.docs.forEach(e=>{let s,a,i=e[0].start,c=e[e.length-1].end;switch(t){case"after":s=c,a=o.slice(n,s),r.push(a),n=s;break;case"before":s=i,a=o.slice(n,s),r.push(a),n=s;break;default:a=o.slice(n,i),r.push(a),n=c}let l=o.slice(i,c);r.push(l)}),a=o.slice(n,o.length),r.push(a),r=r.filter(e=>e.length>0),this.from(r)},ct.split=ct.splitOn,ct.harden=function(){return this.docs=this.docs.map(e=>e.map(e=>e.clone())),this.compute(),this},ct.soften=function(){return this.docs=this.docs.map(e=>e.map(e=>this.pool.get(e.id))),this.compute(),this};var lt=ct;const pt=e=>e.length>0?e[0][e[0].length-1]:null,dt=e=>e.length>0?e[e.length-1][e[e.length-1].length-1]:null;const ut=(e,t)=>{if("string"!=typeof e)return!1;let s=!1,o=t.model.one.lexicon[e.toLowerCase()];return o&&(s=o.some(e=>"Date"===e||"Month"===e)),s},ht=e=>/^(north|south|east|west)[\b\s-]/i.test(e)||/(north|south|east|west)$/i.test(e),mt=/^(drs?|m[rs]s?|rev|hon|esq|prof|pope|sa?int)$/i,ft=/^(st|main|way|rd|ave|dr|blvd|ln|ct|hwy|fwy|pde|sq|pl)$/i;var yt={isAcronym:function(){return this.match("/^([A-Z]\\.)+[A-Z]?$/").found},isAbbreviation:function(){return this.match("#Abbreviation").found},isCurrency:function(){return this.match("#Currency").found},isMonth:function(){return this.match("#Month").found},isWeekDay:function(){return this.match("#WeekDay").found},isPossessive:function(){return this.match("/'s$/").found},isStation:function(){return this.match("/(train|subway|metro) station$/").found},isStreet:function(){return this.match("#Street").found},isOrdinal:function(){return this.match("#Ordinal").found},isCardinal:function(){return this.match("#Cardinal").found},isDate:function(e){return void 0===e?this.match("#Date").found:this.match("#Date").terms().some(t=>ut(t.normal,e))},isUrl:function(){return this.match("#Url").found},isEmail:function(){return this.match("#Email").found},isPhoneNumber:function(){return this.match("#PhoneNumber").found},isHashtag:function(){return this.match("#Hashtag").found},isAtMention:function(){return this.match("#AtMention").found},isOrganization:function(e){return void 0===e?this.match("#Organization").found:this.match("#Organization").terms().some(t=>t.tags.has("Organization"))},isPerson:function(e){return void 0===e?this.match("#Person").found:this.match("#Person").terms().some(t=>t.tags.has("Person"))},isPlace:function(e){let t=this.match("#Place");if(void 0===e)return t.found;let s=t.terms();return s.some(t=>t.tags.has("Place"))||s.some(t=>ht(t.normal,e))},isAddress:function(){return this.match("#Address").found},isVerb:function(){return this.match("#Verb").found},isAdjective:function(){return this.match("#Adjective").found},isAdverb:function(){return this.match("#Adverb").found},isNoun:function(){return this.match("#Noun").found},isPronoun:function(){return this.match("#Pronoun").found},isConjunction:function(){return this.match("#Conjunction").found},isPreposition:function(){return this.match("#Preposition").found},isDeterminer:function(){return this.match("#Determiner").found},isQuotation:function(){return this.match("(#Quotation|#Parentheses)").found}};const gt={};gt.adjectives=function(){return this.match("#Adjective")},gt.conjunctions=function(){return this.match("#Conjunction")},gt.verbs=function(){return this.match("#Verb")},gt.adverbs=function(){return this.match("#Adverb")},gt.nouns=function(){return this.match("#Noun")},gt.pronouns=function(){return this.match("#Pronoun")},gt.prepositions=function(){return this.match("#Preposition")},gt.determiners=function(){return this.match("#Determiner")},gt.values=function(){return this.match("#Value")},gt.symbols=function(){return this.match("#Symbol")};const xt={};xt.acronyms=function(e,t){let s=this.match("/^([A-Z]\\.)+[A-Z]?$/").unique();return"number"==typeof e?s.get(e):s},xt.abbreviations=xt.acronyms,xt.topics=function(e,t){return this.match("#Topic").get(e)},xt.people=function(e,t){return this.match("#Person+").get(e)},xt.organizations=function(e,t){return this.match("#Organization+").get(e)},xt.places=function(e,t){return this.match("#Place+").get(e)},xt.phoneNumbers=function(e,t){return this.match("#PhoneNumber").get(e)},xt.emails=function(e,t){return this.match("#Email").get(e)},xt.urls=function(e,t){return this.match("#Url").get(e)},xt.hashtags=function(e,t){return this.match("#Hashtag").get(e)},xt.atMentions=function(e,t){return this.match("#AtMention").get(e)},xt.emoticons=function(e,t){return this.match("#Emoticon").get(e)},xt.emojis=function(e,t){return this.match("#Emoji").get(e)},xt.quotations=function(e,t){return this.match("#Quotation").get(e)},xt.parentheses=function(e,t){return this.match("#Parentheses").get(e)};var bt=Object.assign({},gt,xt,{hyphenated:function(){return this.match("#Hyphenated")},adjectives:function(){return this.match("#Adjective")},conjunctions:function(){return this.match("#Conjunction")},prepositions:function(){return this.match("#Preposition")},determiners:function(){return this.match("#Determiner")},verbs:function(){return this.match("#Verb")},nouns:function(){return this.match("#Noun")},pronouns:function(){return this.match("#Pronoun")},adverbs:function(){return this.match("#Adverb")},values:function(){return this.match("#Value")},symbols:function(){return this.match("#Symbol")}});bt.things=bt.nouns,bt.tags=function(e){let t={};return this.docs.forEach(e=>e.forEach(e=>Object.keys(e.tags).forEach(e=>t[e]=t[e]||0,t[e]+=1))),t=Object.entries(t),e&&"string"==typeof e&&"alphabetical"===e&&(t=t.sort((e,t)=>e[0]>t[0]?1:-1)),e&&"string"==typeof e&&"frequency"===e&&(t=t.sort((e,t)=>e[1]>t[1]?-1:1)),t};const Ct=e=>{let t={};return e.docs.forEach(e=>{let s=e[0].start,o=e[e.length-1].start,r=e[e.length-1].end-e[0].start;if(s)t.char=s;t.length=r,t.start=e[0].offset.start,t.index=e[0].doc_index}),t},vt={terms:e=>e.termList(),words:e=>e.termList(),fullTerms:e=>e.docs,sentences:e=>{let t=[];const s=e=>e.parent.isA("Sentence")?e.parent:null;for(let o=0;o<e.docs.length;o++){let r=e.docs[o];if(r&&r.length>0){let e=s(r[0]);e&&t.push(e)}}return e.from(t).unique()},offset:e=>Ct(e)};const wt=(e,t)=>{let s={};if(void 0===t){let t=e.world.model.one.lexicon;e.docs.forEach(e=>e.forEach(e=>{Object.keys(t).forEach(t=>{let o=t.split(" ");e.normal.length>3&&t.length>4&&o.length>1&&-1!==e.normal.indexOf(t)&&console.log(t)})}))}else{s.words={};let o={};e.docs.forEach(e=>e.forEach(e=>o[e.normal]=!0)),Object.keys(o).forEach(e=>{s.words[e]=t})}return e.world.words=Object.assign({},e.world.words||{},s.words),e.world},Tt=(e,t)=>{let s=e.match(t).termList();return s.forEach(t=>{delete e.world.words[t.normal]}),e},Ot=(e,t)=>{let s=e.splitOn(t),o=[],r=0;return s.list.forEach(e=>{e.match(t).found||o.push(e)}),e.from(o)};const St={adjectives:{},nouns:{},verbs:{}};St.adjectives.toComparative=function(e,t){return this.match(e).adjectives().toComparative()},St.adjectives.toSuperlative=function(e,t){return this.match(e).adjectives().toSuperlative()},St.adjectives.toNoun=function(e,t){return this.match(e).adjectives().toNoun()},St.adjectives.toAdverb=function(e,t){return this.match(e).adjectives().toAdverb()},St.nouns.toPlural=function(e,t){return this.match(e).nouns().toPlural()},St.nouns.toSingular=function(e,t){return this.match(e).nouns().toSingular()},St.nouns.toAdjective=function(e,t){return this.match(e).nouns().toAdjective()},St.verbs.toPresentTense=function(e,t){return this.match(e).verbs().toPresentTense()},St.verbs.toPastTense=function(e,t){return this.match(e).verbs().toPastTense()},St.verbs.toGerund=function(e,t){return this.match(e).verbs().toGerund()},St.verbs.toInfinitive=function(e,t){return this.match(e).verbs().toInfinitive()},St.verbs.isNegative=function(){return this.match("#Negative")},St.verbs.isPositive=function(){return this.match("!#Negative")},St.verbs.toPositive=function(){return this.match("!#Negative")},St.verbs.toNegative=function(){return this.match("#Negative")};const kt=(e,t,s)=>{let o=e.match(t).termList();return s.docs.forEach(e=>e.forEach(t=>{o.forEach(s=>{t.id===s.id&&(e.dirty=!0)})})),s};const Dt=function(e){this.view=e};Dt.prototype.compute=function(e,t){let s=this.view;s.docs.forEach(t=>{if(t.dirty){if("lexicon"===e)return this.lexicon(t,s.world);if("pre-tags"===e)return this.preTagger(t,s.world);if("phrases"===e)return this.phraser(t,s.world);if("fallbacks"===e)return this.fallback(t,s.world);if("contractions"===e)return this.contraction(t,s.world);if("normalize"===e)return this.normal(t,s.world);s.world.compute[e](t,s.world)}t.dirty=!1}),this.view.dirty=!1};var Lt=Dt;Lt.prototype.lexicon=function(e,t){let s=t.model.one.lexicon,o=Object.keys(s);e.forEach(e=>{if(!e.tags.size>0&&!e.implicit){let t=e.normal.toLowerCase();if(s.hasOwnProperty(t))return e.tag(s[t],"lexicon-match");let r=o.find(e=>-1!==t.indexOf(e));if(r)return e.tag(s[r],"lexicon-overlap")}})},Lt.prototype.normal=function(e,t){e.forEach(e=>{let s=e.word;s=s.toLowerCase().trim(),s=s.replace(/[,;:]$/,""),s=s.replace(/[(]$/,""),s=s.replace(/[)"]+$/,""),s=s.replace(/['’]s$/,""),s=s.replace(/'/,"");let o=s.match(re);o&&(s=o[1]);let r=s.match(/^#(.+)/);r&&(s=r[1]);let n=t.model,a=n.two.normalize.hasOwnProperty(s);a&&(s=n.two.normalize[s]);let i=d[s]||s;i=ae(i)?N.toSingular(i):i,t.contractions[i]&&(i=t.contractions[i]),e.implicit||(e.normal=i),e.machine=i,e.root=t.methods.two.findRoot(e,t)})},Lt.prototype.fallback=function(e,t){let s=Object.keys(t.model.one.lexicon);e.forEach(e=>{if(0===e.tags.size){if(e.word.length>1&&!s.hasOwnProperty(e.normal)){if(yt.isAcronym(e))return e.tag("Acronym","is-acronym"),void e.tag("Noun","acronym-fallback");if(o=/^[A-Z][a-z']+s?$/.test(e.word))return e.tag("ProperNoun","titlecase-fallback"),void e.tag("Noun","prop-noun-fallback");if(/^[a-z][a-z'#]+-[a-z'#]+[a-z]?$/i.test(e.word))return e.tag("Hyphenated","hyphenated-fallback"),void e.tag("Adjective","hyphen-adj-fallback");if(/^[0-9+]+$/.test(e.word))return e.tag("Numeric","numeric-fallback"),void e.tag("Cardinal","cardinal-fallback");if(/[a-z]/.test(e.word))return void e.tag("Noun","noun-fallback")}}})},Lt.prototype.contraction=function(e,t){e.forEach((e,s)=>{let o=t.world.contractions[e.normal];o&&o.length>1&&(e.terms=he(o,t.world).map(e=>new I(e)),e.terms.forEach(t=>{e.dirty=!0,t.dirty=!0,this.normal([t],{model:t.world.model})}),e.tags=new Set)})};const Nt={};Nt.preTagger=function(e,t){let s=t.model.one.preTags;Object.keys(s).forEach(o=>{let r=s[o],n=e.match(o);n.found&&n.tag(r,"pre-tagger")})},Nt.postTroller=function(e,t){let s=t.model.one.postTags;Object.keys(s).forEach(o=>{let r=s[o],n=e.match(o);n.found&&n.tag(r,"post-tagger")})};const It=function(e){this.terms=e.terms.map(e=>new I(e.word,Object.assign({},e.tags)))};It.prototype.has=function(e){if(e.startsWith("!")){e=e.substr(1);for(let t=0;t<this.terms.length;t+=1)if(this.terms[t].tags[e])return!1;return!0}if(e.startsWith("#"))e=e.substr(1);else for(let t=0;t<this.terms.length;t+=1)if(this.terms[t].normal===e)return!0;for(let s=0;s<this.terms.length;s+=1)if(this.terms[s].tags[e])return!0;return!1};const At=function(e,t,s){let o;if(s)o=function(e,t){let s=[];for(let o=0;o<e.length;o++){let r={};for(let s in e[o])r[s]=e[o][s];r.text=r.text.toLowerCase(),s.push(r)}return s}(t);else o=t;let r=s||"";const n=(e,t)=>e.reduce((e,s)=>e.concat(t.map(t=>[...s,t])),[[]]);n([[[1,2]],[[3,4]]],[[5,6],[7,8]]);let a=function(e,t){let s=n(e.map(e=>e[t]||[]),[]).filter(e=>e.length>0);return s}(o,"sense");a=a.map(e=>new It(e));let i=[];a.forEach((t,s)=>{let n=!0;e.forEach(e=>{"if"===e.op&&(n=t.has(e.match)),"if_not"===e.op&&(n=!t.has(e.match))}),!0===n&&i.push(o[s])});let c=i[0]||{};return e=c.words?c.words.map(e=>e.text?e.text:e).join(r):"",e},Pt=e=>{if("string"==typeof e)return e.split(/ /g);if("object"==typeof e&&e.isA)return e.termList().map(e=>e.normal)},Mt=(e,t)=>{let s=[];e.forEach(e=>{if(!e)return;let o=!1;t.forEach(t=>{t.start===e.start&&t.length===e.length&&(o=!0)}),!1===o&&s.push(e)}),e.length=0,e.push(...s)},Ft=e=>void 0===e?[]:"string"==typeof e?e.split(" ").filter(e=>e):Array.isArray(e)?e:[e],Rt=(e,t)=>{if("string"==typeof e)return t.match(e);if("object"==typeof e&&e.isA)return e;if("function"==typeof e)return e(t);return t.from([])};const Et={noun:{before:"(Adjective|Noun|Preposition|Determiner|Adverb|Conjunction)$",after:"^(Noun|Verb|Copula|Preposition|Adverb|Conjunction)"}},zt={};zt.checkNegative=function(e){let t=e.match("(not|aint|never)");if(t.found)return t.tag("Negative","found-not"),e.match("#Verb+").tag("Negative","verb-not"),!0;t=e.match("(none|neither|not a|hardly|barely)");if(t.found)return e.tag("Negative","found-none"),!0;return e.match("without #Noun").tag("Negative","without-noun"),!1},zt.checkNumber=function(e){let t=e.match("#Value+");t.match("/[0-9]$/").tag("Numeric","end-number"),t.match("#TextValue #Multiple").tag("Multiple","multiple-text"),t.match("a (#Value|hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)").tag("Multiple","a-is-one")},zt.checkDate=function(e){let t=e.match("#Date+");t.match("(in|by|before|during|on|until|after|of|within) #Date").tag("Time","date-ish"),e.match("(#WeekDay|#Month) (the|a) #Value").lastTerm().tag("Ordinal","date-ordinal"),e.match("(the|a) #Value of (#WeekDay|#Month)").term(1).tag("Ordinal","date-ordinal"),e.match("#Month #Value").term(1).tag("Cardinal","month-cardinal"),e.match("#Value #Month").term(0).tag("Cardinal","date-cardinal"),e.match("#Month #Ordinal").term(1).tag("Ordinal","month-ordinal"),e.match("(next|last|this|previous|current|upcoming|coming|the) #WeekDay").tag("Date","next-weekday"),e.match("in #Month").tag("Date","in-month"),e.match("on #WeekDay").tag("Date","on-weekday"),e.match("(in|of|by|during) #Year").tag("Date","in-year")},zt.checkParentheses=function(e){let t=e.match("#Parentheses");if(t.found){let e=t.match("!#OpenParen").match("!#CloseParen");e.found&&e.tag("#Noun","paren-noun").tag("Singular","paren-singular")}},zt.checkPossessive=function(e){let t=e.match("[#Possessive] #Noun+");t.match("!#Pronoun$").lastTerm().tag("Possessive","possessive-noun");let s=e.match("#Noun [of] #Noun");s.match("!#Pronoun$").lastTerm().tag("Possessive","noun-of-noun")},zt.checkAcronym=function(e){let t=e.match("/^([a-z]\\.)+[a-z]?$/");t.found&&t.tag("Abbreviation","acronym-abbreviation").tag("Noun","acronym-noun");let s=e.match("/^[A-Z]{3,8}$/");s.match("!#ProperNoun").tag("Acronym","acronym-like"),e.match("the #Acronym").tag("Organization","the-acronym")},zt.checkPerson=function(e){e.match("(#Person|#Place) of #Place").tag("Person","king-of-queen"),e.match("#Person #Person").match("#ProperNoun").tag("Person","person-person"),e.match("#Person (and|or) #Person").tag("Person","person-and-person"),e.match("(mr|mrs|ms|dr) #Honorific? #Person?").tag("Person","dr-name"),e.match("#Acronym #Person").ifNo("#Date").tag("Person","acronym-person"),e.match("#Person #Acronym").ifNo("#Date").tag("Person","person-acronym"),e.match("#Person #Noun").if("#ProperNoun").lastTerm().tag("Person","person-noun-person"),e.match("#Person the #Adjective? #Noun").ifNo("(#Possessive|#Place|#Date|#Organization)").tag("Person","person-the-noun"),e.match("#Honorific #Person").tag("Person","honorific-person"),e.match("#Person #Honorific").tag("Person","person-honorific"),e.match("#Person #Verb").lastTerm().tag("FirstName","person-verb"),e.match("#ProperNoun #Person").ifNo("#Date").firstTerm().tag("Person","proper-person"),e.match("#Noun #Person").ifNo("#Date").firstTerm().tag("FirstName","noun-person"),e.match("#Person [#ProperNoun] (Jr|Sr)").tag("Person","jr-sr-person")};const Ut=function(e,t,s,o){this.world=s,this.methods=s.methods,this.model=s.model,this.docs=e,this.pointer=o,this.isA="View",Object.defineProperty(this,"parent",{get:()=>{let e=this.world.pool.get(this.docs[0][0].from);return this.fromDoc([e])},enumerable:!1}),Object.defineProperty(this,"length",{get:()=>this.docs.length})};Ut.prototype.from=ot,Ut.prototype.fromDoc=it.fromDoc,Ut.prototype.all=it.all;for(let e=0;e<at.length;e++)Ut.prototype[at[e]]=nt[at[e]];let Bt=new Lt;Ut.prototype.compute=function(e){return Bt.compute(e),this};var Kt=Ut;const Gt=e=>{const t=(t,s)=>new Kt(t,s,e,null);t.world=()=>e,t.model=()=>e.model,t.methods=()=>e.methods,t.compute=function(t){for(let s=0;s<e.fns.compute.length;s++){let o=e.fns.compute[s];this.list.forEach(e=>o(t,e))}return this},t.tokenize=s=>{let o=e.methods.one.tokenize(s,e);return new Kt([o],null,e,null)},t.version=e.version;let s=Object.keys(e.methods.one);for(let o=0;o<s.length;o++){let r=s[o];t[r]=function(){let s=Array.from(arguments);s.unshift(this);let o=e.methods.one[r].apply(e.methods.one,s);return"string"==typeof o||"number"==typeof o||null===o||!1===o||!0===o||void 0===o||Array.isArray(o)?o:new Kt([o],null,e,null)}}return t},Wt={models:{},methods:{},hooks:[]},$t={addNormal:function(e){Object.assign(this.world.model.two.normalize,e)},addWords:function(e){Object.assign(this.world.model.one.lexicon,e)},addTags:function(e){Object.assign(this.world.model.one.tagSet,e)},addPlurals:function(e){Object.assign(this.world.model.two.plurals,e)},addConjugations:function(e){Object.assign(this.world.model.two.conjugations,e)},plugin:function(e){if(e.model&&(Object.keys(e.model).forEach(t=>{Object.assign(Wt.models[t],e.model[t])}),this.world.model=Ne([Wt.models.one,Wt.models.two,Wt.models.three])),e.methods)for(let t=1;t<=3;t+=1){let s=Object.keys(e.methods)[t-1];e.methods[s]&&Object.keys(e.methods[s]).forEach(o=>{Wt.methods[s][o]=e.methods[s][o]})}e.hooks&&e.hooks.forEach(e=>Wt.hooks.push(e)),this.world.methods=Ne([Wt.methods.one,Wt.methods.two,Wt.methods.three]),this.world.hooks=Wt.hooks;let t=Gt(this.world);return Object.assign(t,this.methods.top),t}};const Vt={};Vt.build=function(e){let t=this;return e.forEach(e=>{let s=he(e.text,t.world);s=s.map(e=>new I(e)),t.docs.push(s)}),this},Vt.load=function(e){e=e.map(e=>{let t=he(e,this.world);return t=t.map(e=>new I(e)),t}),this.docs=e},Vt.fromString=function(e,t){return this.docs=[he(e,this.world).map(e=>new I(e,{}))],this};const jt=e=>{const t=function(e,s){let o={};Object.assign(o,Wt),o.model=Ne([Wt.models.one,Wt.models.two,Wt.models.three]),o.methods=Ne([Wt.methods.one,Wt.methods.two,Wt.methods.three]),o.hooks=Wt.hooks;let r={};Object.keys(o.model.one.lexicon).forEach(e=>{let t=o.model.one.lexicon[e];"string"==typeof t&&(t=[t]),t.forEach(t=>{r[e]=t})}),o.model.one.lexicon=r;let n=new Kt([],void 0,o,null);n.docs=[[]];let a=Gt(o);if(Object.assign(a,$t),e)if("string"==typeof e)Vt.fromString.call(n,e);else if("object"==typeof e){if(e.build)return e;Vt.build.call(n,e)}return n.compute("pre-tags"),n.compute("lexicon"),n.compute("phrases"),n.compute("fallbacks"),n.compute("normalize"),n.compute("contractions"),n};return t.plugin=$t.plugin,t};var qt=jt;let Ht={};Ht.preTagger=Nt.preTagger,Ht.postTroller=Nt.postTroller,Ht.phraser=function(e,t){zt.checkAcronym(e),zt.checkNegative(e),zt.checkNumber(e),zt.checkDate(e),zt.checkPerson(e),zt.checkPossessive(e),zt.checkParentheses(e)};const Zt={normalize:{},findRoot:e=>e.normal};Zt.normalize["a few"]="some",Zt.normalize.between="between";const Jt={irregulars:{plural:c,verb:A,adjective:{}},plurals:S,conjugations:{}};var Qt=Object.assign({},Jt,{conjugations:Jt.conjugations,findRoot:function(e,t){let s=e.normal,o=t.model;if(e.tags.has("Plural")&&s!==N.toSingular(s))return s=N.toSingular(s);if(e.tags.has("PresentTense"))s=V.toInfinitive(s,o);else if(e.tags.has("PastTense"))s=V.toInfinitive(s,o);else if(e.tags.has("Gerund"))s=V.toInfinitive(s,o);else if(e.tags.has("Actor"))s=s.replace(/er$/,"");else if(e.tags.has("Comparative")&&s.endsWith("er"))s=s.replace(/er$/,"");else if(e.tags.has("Superlative")&&s.endsWith("est"))s=s.replace(/est$/,"");return s}});const Xt={contractions:{"'s":"is","'ll":"will","'re":"are","'ve":"have","'d":"would",n't:"not",im:"i am",ive:"i have",cant:"can not",dont:"do not",wont:"will not",isnt:"is not",wasnt:"was not",werent:"were not",havent:"have not",hadnt:"have not",hasnt:"has not",couldnt:"could not",shouldnt:"should not",wouldnt:"would not",wanna:"want to",gonna:"going to",lemme:"let me",gimme:"give me",imma:"i am going to",gotta:"got to",aint:"is not",yall:"you all"},honorifics:{mr:!0,mrs:!0,ms:!0,dr:!0,prof:!0,rev:!0,esq:!0,hon:!0,jr:!0,sr:!0,messrs:!0,maj:!0,gen:!0,adm:!0,lt:!0,col:!0,sgt:!0,capt:!0,st:!0,saint:!0},ambiguous:{act:!0,advance:!0,approach:!0,attack:!0,back:!0,ban:!0,battle:!0,call:!0,change:!0,clone:!0,close:!0,comfort:!0,compost:!0,concern:!0,cover:!0,cross:!0,crush:!0,cut:!0,damage:!0,deal:!0,demand:!0,design:!0,desire:!0,dislike:!0,dispute:!_0,divorce:!0,drift:!0,dump:!0,echo:!0,envy:!0,escape:!0,experience:!0,export:!0,face:!0,fall:!0,fear:!0,feel:!0,figure:!0,film:!0,finish:!0,fire:!0,fix:!0,fold:!0,form:!0,front:!0,fuel:!0,function:!0,fund:!0,gain:!0,guess:!0,handle:!0,hate:!0,head:!0,heat:!0,help:!0,hit:!0,hope:!0,increase:!0,influence:!0,insult:!0,interview:!0,iron:!0,joke:!0,judge:!0,keep:!0,kick:!0,kill:!0,kiss:!0,knock:!0,labor:!0,lecture:!0,level:!0,license:!0,link:!0,load:!0,look:!0,love:!0,mail:!0,map:!0,market:!0,match:!0,mention:!0,mind:!0,mirror:!0,monitor:!0,move:!0,name:!0,need:!0,nod:!0,note:!0,notice:!0,pack:!0,park:!0,pass:!0,patch:!0,pause:!0,peak:!0,pedal:!0,perfume:!0,photograph:!0,place:!0,plan:!0,plant:!0,play:!0,police:!0,post:!0,prize:!0,program:!0,protest:!0,pump:!0,push:!0,question:!0,race:!0,reason:!0,recall:!0,record:!0,recruit:!0,redesign:!0,request:!0,rescue:!0,research:!0,return:!0,review:!0,reward:!0,ring:!0,rip:!0,rock:!0,roll:!0,ruin:!0,run:!0,rush:!0,sail:!0,scan:!0,schedule:!0,scratch:!0,screw:!0,search:!0,sense:!0,service:!0,shape:!0,share:!0,shed:!0,shift:!0,ship:!0,shock:!0,shoot:!0,show:!0,sign:!0,signal:!0,size:!0,sleep:!0,slur:!0,smell:!0,smile:!0,smoke:!0,sound:!0,span:!0,speed:!0,spin:!0,sponsor:!0,spot:!0,stain:!0,stand:!0,start:!0,stay:!0,step:!0,stick:!0,stop:!0,store:!0,stress:!0,strike:!0,struggle:!0,study:!0,stunt:!0,support:!0,surprise:!0,swing:!_0,switch:!0,taste:!0,test:!0,throw:!0,tie:!0,time:!0,tire:!0,top:!0,touch:!0,track:!0,trade:!0,train:!0,trap:!0,travel:!0,treat:!0,trust:!0,turn:!0,type:!0,upload:!0,use:!0,vacuum:!0,value:!0,view:!0,visit:!0,vote:!0,wait:!0,walk:!0,watch:!0,wave:!0,wear:!0,whistle:!0,work:!0,worry:!0,wound:!0}},Yt={preTags:{can:"Modal",may:"Modal",might:"Modal",shall:"Modal",will:"Modal",must:"Modal",would:"Modal","[#Copula] [#Gerund]$":"Verb",before:"Preposition",after:"Preposition",of:"Preposition",about:"Preposition","[#Adjective] [#Adverb]$":"Adjective","[#Adverb] [#Adjective]$":"Adverb","[#Adverb] [#Verb]$":"Verb"},postTags:{},lexicon:{"i'm":"i am","i've":"i have","i'll":"i will","i'd":"i would","i'd":"i had"},patterns:{},tagSet:{Noun:{isA:"Noun",nice:"blue"},Verb:{isA:"Verb",nice:"green"},Adjective:{isA:"Adjective",nice:"red"}}};Yt.lexicon.down=Yt.lexicon.under="Preposition",Yt.lexicon["if so"]="Conjunction",Yt.lexicon["if not"]="Conjunction",Yt.lexicon["if only"]="Conjunction",Yt.lexicon["if and when"]="Conjunction",Yt.lexicon["if, when"]="Conjunction",Yt.lexicon["if after"]="Conjunction",Yt.lexicon["if, after"]="ConDjunction",Yt.lexicon["if before"]="Conjunction",Yt.lexicon["if, before"]="Conjunction",Yt.lexicon["if, once"]="Conjunction",Yt.lexicon["not withstanding"]="Conjunction";const J={Person:{isA:"Noun",partOfSpeech:"Person"},Place:{isA:"Noun"},Organization:{isA:"Noun"},Value:{isA:"Noun"},Date:{isA:"Noun"},Actor:{isA:"Noun",partOfSpeech:"Actor"},Demonym:{isA:"Noun",partOfSpeech:"Demonym"},Pronoun:{isA:"Noun",partOfSpeech:"Pronoun"},Possessive:{isA:"Pronoun"},Honorific:{partOfSpeech:"Honorific"},Mutual:{isA:["Adjective","Noun"]},FirstName:{isA:"Person"},LastName:{isA:"Person"},MaleName:{isA:"FirstName"},FemaleName:{isA:"FirstName"},NickName:{isA:"FirstName"},ProperNoun:{isA:"Noun"},Acronym:{isA:"Noun"},Abbreviation:{isA:"Noun"},Adjective:{partOfSpeech:"Adjective"},Comparative:{isA:"Adjective"},Superlative:{isA:"Adjective"},NumberRange:{isA:"Hyphenated"},Conjunction:{partOfSpeech:"Conjunction"},Determiner:{partOfSpeech:"Determiner"},Preposition:{partOfSpeech:"Preposition"},QuestionWord:{partOfSpeech:"QuestionWord"},Expression:{partOfSpeech:"Expression"},Adverb:{partOfSpeech:"Adverb"},Verb:{partOfSpeech:"Verb"},PresentTense:{isA:"Verb"},Infinitive:{isA:"Verb"},Gerund:{isA:"Verb"},PastTense:{isA:"Verb"},PerfectTense:{isA:"Verb"},FuturePerfect:{isA:"Verb"},Pluperfect:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb"},Participle:{isA:"Verb"},Particle:{isA:"Verb"},Auxiliary:{isA:"Verb"},Negative:{isA:["Adjective","Adverb"]},Contraction:{isA:"Verb"},VerbPhrase:{isA:"Verb"},PhrasalVerb:{isA:"Verb"},Ordinal:{isA:"Value"},Cardinal:{isA:"Value"},Numeric:{isA:"Value"},TextValue:{isA:"Value"},Money:{isA:"Value"},Percent:{isA:"Value"},RomanNumeral:{isA:"Value"},Fraction:{isA:"Value"},Multiple:{isA:"Value"},Url:{isA:"Noun"},Email:{isA:"Noun"},AtMention:{isA:"Noun"},Hashtag:{isA:"Noun"},Emoji:{isA:"Noun"},Emoticon:{isA:"Noun"},Month:{isA:"Date"},WeekDay:{isA:"Date"},Time:{isA:"Date"},Holiday:{isA:"Date"},Duration:{isA:"Date"},Year:{isA:"Date"},Address:{isA:"Place"},Street:{isA:"Address"},City:{isA:"Place"},Region:{isA:"Place"},Country:{isA:"Place"},Condition:{isA:"Noun"},Activity:{isA:"Noun"},Sport:{isA:"Activity"},Unit:{isA:"Noun"},Substance:{isA:"Noun"},Organ:{isA:"Noun"},Taxon:{isA:"Noun"},Currency:{isA:"Noun"},VerbPhrase:{isA:["Verb","Noun"]},NounPhrase:{isA:"Noun"},ValuePhrase:{isA:"Value"},ClauseEnd:!1,SVA:!1,AdjectivePhrase:!1,Quotation:!1,Parentheses:!1,Possessive:!1,Hyphenated:!1,StartTense:!1,EndTense:!1,Imperative:!1,TitleCase:!1,CamelCase:!1,UpperCase:!1,Initial:!1,Clause:!1};for(const e in J)J[e].nice=e.replace(/([A-Z])/g," $1").toLowerCase().trim().replace(/ /g,"-");const Q=["January","February","March","April","May","June","July","August","September","October","November","December"],X=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];let Y=["ton","day","week","month","year","decade"],ee={};Y.forEach(e=>{ee[e]="Duration",ee[e+"s"]="Duration"}),Q.forEach(e=>{ee[e]="Month"}),X.forEach(e=>{ee[e]="WeekDay"}),ee.xmas="Holiday",ee.valentines="Holiday",ee.today="Date",ee.tomorrow="Date",ee.yesterday="Date",ee.weekend="Date",ee.weekday="Date",ee.evening="Time",ee.tonight="Time",ee.noon="Time",ee.morning="Time",ee.midnight="Time",ee.afternoon="Time",ee.ante="Time",ee.post="Time",ee.future="Date",ee.past="Date",ee.present="Date",ee.now="Time",ee.day="Duration",ee.second="Duration",ee.minute="Duration",ee.hour="Duration",ee.century="Duration",ee.millennium="Duration",ee.easter="Holiday",ee.christmas="Holiday",ee.thanksgiving="Holiday",ee["new years"]="Holiday";const te={};te.i="Pronoun",te.he="Pronoun",te.she="Pronoun",te.we="Pronoun",te.they="Pronoun",te.me="Pronoun",te.him="Pronoun",te.her="Pronoun",te.us="Pronoun",te.them="Pronoun",te.myself="Pronoun",te.yourself="Pronoun",te.himself="Pronoun",te.herself="Pronoun",te.itself="Pronoun",te.ourselves="Pronoun",te.yourselves="Pronoun",te.themselves="Pronoun",te.mine="Pronoun",te.yours="Pronoun",te.his="Pronoun",te.hers="Pronoun",te.its="Pronoun",te.ours="Pronoun",te.theirs="Pronoun",te.this="Pronoun",te.that="Pronoun",te.these="Pronoun",te.those="Pronoun",te.who="Pronoun",te.whom="Pronoun",te.whose="Pronoun",te.which="Pronoun",te.what="Pronoun",te.that="Pronoun",te.whoever="Pronoun",te.whomever="Pronoun",te.whichever="Pronoun",te.whatever="Pronoun",te.anybody="Pronoun",te.anyone="Pronoun",te.anything="Pronoun",te.each="Pronoun",te.either="Pronoun",te.everybody="Pronoun",te.everyone="Pronoun",te.everything="Pronoun",te.neither="Pronoun",te.nobody="Pronoun",te.noone="Pronoun",te.nothing="Pronoun",te.one="Pronoun",te.somebody="Pronoun",te.someone="Pronoun",te.something="Pronoun",te.both="Pronoun",te.few="Pronoun",te.many="Pronoun",te.several="Pronoun",te.all="Pronoun",te.any="Pronoun",te.most="Pronoun",te.none="Pronoun",te.some="Pronoun",te.myself="Possessive",te.yourself="Possessive",te.himself="Possessive",te.herself="Possessive",te.itself="Possessive",te.ourselves="Possessive",te.yourselves="Possessive",te.themselves="Possessive",te.mine="Possessive",te.yours="Possessive",te.his="Possessive",te.hers="Possessive",te.its="Possessive",te.ours="Possessive",te.theirs="Possessive",te.their="Possessive",te.her="Possessive",te.my="Possessive",te.your="Possessive",te.our="Possessive";const se={am:"Copula",are:"Copula",is:"Copula",was:"Copula",were:"Copula",been:"Copula",being:"Copula","ain't":"Negative",have:"Auxiliary",has:"Auxiliary",had:"Auxiliary",do:"Auxiliary",does:"Auxiliary",did:"Auxiliary",will:"Modal",shall:"Modal",may:"Modal",might:"Modal",can:"Modal",could:"Modal",would:"Modal",should:"Modal",must:"Modal",ought:"Modal",let:"Modal",letting:"Gerund",lets:"PresentTense",begin:"Infinitive",began:"PastTense",begun:"PastTense",come:"Infinitive",came:"PastTense",eat:"Infinitive",ate:"PastTense",eaten:"PastTense",break:"Infinitive",broke:"PastTense",broken:"PastTense",drink:"Infinitive",drank:"PastTense",drunk:"PastTense",speak:"Infinitive",spoke:"PastTense",spoken:"PastTense",swim:"Infinitive",swam:"PastTense",swum:"PastTense",take:"Infinitive",took:"PastTense",taken:"PastTense",drive:"Infinitive",drove:"PastTense",driven:"PastTense",write:"Infinitive",wrote:"PastTense",written:"PastTense",go:"Infinitive",went:"PastTense",gone:"PastTense",ring:"Infinitive",rang:"PastTense",rung:"PastTense",sing:"Infinitive",sang:"PastTense",sung:"PastTense",see:"Infinitive",saw:"PastTense",seen:"PastTense",know:"Infinitive",knew:"PastTense",known:"PastTense",wear:"Infinitive",wore:"PastTense",worn:"PastTense",give:"Infinitive",gave:"PastTense",given:"PastTense",forgive:"Infinitive",forgave:"PastTense",forgiven:"PastTense",forbid:"Infinitive",forbade:"PastTense",forbidden:"PastTense",lie:"Infinitive",lay:"PastTense",lain:"PastTense",fly:"Infinitive",flew:"PastTense",flown:"PastTense",slay:"Infinitive",slew:"PastTense",slain:"PastTense",rise:"Infinitive",rose:"PastTense",risen:"PastTense",arise:"Infinitive",arose:"PastTense",arisen:"PastTense",choose:"Infinitive",chose:"PastTense",chosen:"PastTense",get:"Infinitive",got:"PastTense",gotten:"PastTense",forget:"Infinitive",forgot:"PastTense",forgotten:"PastTense",fall:"Infinitive",fell:"PastTense",fallen:"PastTense",shake:"Infinitive",shook:"PastTense",shaken:"PastTense",wake:"Infinitive",woke:"PastTense",woken:"PastTense",make:"Infinitive",made:"PastTense",read:"Infinitive",read:"PastTense",hear:"Infinitive",heard:"PastTense",leave:"Infinitive",left:"PastTense",keep:"Infinitive",kept:"PastTense",sleep:"Infinitive",slept:"PastTense",feel:"Infinitive",felt:"PastTense",deal:"Infinitive",dealt:"PastTense",mean:"Infinitive",meant:"PastTense",say:"Infinitive",said:"PastTense",pay:"Infinitive",paid:"PastTense",stand:"Infinitive",stood:"PastTense",understand:"Infinitive",understood:"PastTense",bring:"Infinitive",brought:"PastTense",buy:"Infinitive",bought:"PastTense",fight:"Infinitive",fought:"PastTense",think:"Infinitive",thought:"PastTense",catch:"Infinitive",caught:"PastTense",teach:"Infinitive",taught:"PastTense",find:"Infinitive",found:"PastTense",sell:"Infinitive",sold:"PastTense",tell:"Infinitive",told:"PastTense",sit:"Infinitive",sat:"PastTense",send:"Infinitive",sent:"PastTense",spend:"Infinitive",spent:"PastTense",build:"Infinitive",built:"PastTense",bend:"Infinitive",bent:"PastTense",lend:"Infinitive",lent:"PastTense",lose:"Infinitive",lost:"PastTense",win:"Infinitive",won:"PastTense",shoot:"Infinitive",shot:"PastTense",shine:"Infinitive",shone:"PastTense",hold:"Infinitive",held:"PastTense",stick:"Infinitive",stuck:"PastTense",dig:"Infinitive",dug:"PastTense",hang:"Infinitive",hung:"PastTense",swing:"Infinitive",swung:"PastTense",strike:"Infinitive",struck:"PastTense",become:"Infinitive",became:"PastTense",run:"Infinitive",ran:"PastTense",show:"Infinitive",showed:"PastTense",shown:"PastTense",prove:"Infinitive",proved:"PastTense",proven:"PastTense",lean:"Infinitive",leaned:"PastTense",leant:"PastTense",dream:"Infinitive",dreamed:"PastTense",dreamt:"PastTense",learn:"Infinitive",learned:"PastTense",learnt:"PastTense",smell:"Infinitive",smelled:"PastTense",smelt:"PastTense",spell:"Infinitive",spelled:"PastTense",spelt:"PastTense",spoil:"Infinitive",spoiled:"PastTense",spoilt:"PastTense",burn:"Infinitive",burned:"PastTense",burnt:"PastTense",spit:"Infinitive",spat:"PastTense",spit:"PastTense",cost:"Infinitive",cost:"PastTense",cut:"Infinitive",cut:"PastTense",hit:"Infinitve",hit:"PastTense",hurt:"Infinitive",hurt:"PastTense",let:"Infinitive",let:"PastTense",put:"Infinitive",put:"PastTense",quit:"Infinitive",quit:"PastTense",set:"Infinitive",set:"PastTense",shut:"Infinitive",shut:"PastTense",spread:"Infinitive",spread:"PastTense",bet:"Infinitive",bet:"PastTense",beat:"Infinitive",beat:"PastTense",rid:"Infinitive",rid:"PastTense",upset:"Infinitive",upset:"PastTense",burst:"Infinitive",burst:"PastTense",cast:"Infinitive",cast:"PastTense",shed:"Infinitive",shed:"PastTense",split:"Infinitive",split:"PastTense",thrust:"Infinitive",thrust:"PastTense",had:"PastTense",has:"PresentTense",does:"PresentTense",been:"Participle",begin:"Verb",begins:"Verb",began:"Verb",begun:"Verb",break:"Verb",breaks:"Verb",broke:"Verb",broken:"Verb",come:"Verb",comes:"Verb",came:"Verb",do:"Verb",does:"Verb",did:"Verb",done:"Verb",eat:"Verb",eats:"Verb",ate:"Verb",eaten:"Verb",go:"Verb",goes:"Verb",went:"Verb",gone:"Verb",have:"Verb",has:"Verb",had:"Verb",is:"Verb",was:"Verb",are:"Verb",were:"Verb",be:"Verb",been:"Verb",being:"Verb",know:"Verb",knows:"Verb",knew:"Verb",known:"Verb",run:"Verb",runs:"Verb",ran:"Verb",say:"Verb",says:"Verb",said:"Verb",see:"Verb",sees:"Verb",saw:"Verb",seen:"Verb",take:"Verb",takes:"Verb",took:"Verb",taken:"Verb",think:"Verb",thinks:"Verb",thought:"Verb",make:"Verb",makes:"Verb",made:"Verb",mean:"Verb",means:"Verb",meant:"Verb",am:"Verb",i'm:"Verb"},oe={also:"Adverb",always:"Adverb",never:"Adverb",often:"Adverb",sometimes:"Adverb",usually:"Adverb",soon:"Adverb",quickly:"Adverb",slowly:"Adverb",carefully:"Adverb",easily:"Adverb",well:"Adverb",badly:"Adverb",hard:"Adverb",fast:"Adverb",here:"Adverb",there:"Adverb",everywhere:"Adverb",somewhere:"Adverb",nowhere:"Adverb",today:"Adverb",yesterday:"Adverb",tomorrow:"Adverb",already:"Adverb",just:"Adverb",still:"Adverb",yet:"Adverb",too:"Adverb",very:"Adverb",really:"Adverb",quite:"Adverb",almost:"Adverb",enough:"Adverb",even:"Adverb",not:"Adverb",ago:"Adverb",instead:"Adverb",only:"Adverb",ever:"Adverb",twice:"Adverb",once:"Adverb",abroad:"Adverb",apart:"Adverb",around:"Adverb",back:"Adverb",forth:"Adverb",forward:"Adverb",up:"Adverb",down:"Adverb",in:"Adverb",out:"Adverb",on:"Adverb",off:"Adverb",over:"Adverb",under:"Adverb",together:"Adverb",alone:"Adverb",again:"Adverb",away:"Adverb",thus:"Adverb",hence:"Adverb",therefore:"Adverb",however:"Adverb",moreover:"Adverb",furthermore:"Adverb",consequently:"Adverb",meanwhile:"Adverb",otherwise:"Adverb",somehow:"Adverb",anyhow:"Adverb",anyway:"Adverb",some:"Adverb",much:"Adverb",many:"Adverb",little:"Adverb",less:"Adverb",least:"Adverb",so:"Adverb",then:"Adverb",when:"Adverb",where:"Adverb",why:"Adverb",how:"Adverb",what:"Adverb",which:"Adverb",who:"Adverb",whom:"Adverb",of:"Preposition",with:"Preposition",at:"Preposition",from:"Preposition",into:"Preposition",during:"Preposition",including:"Preposition",until:"Preposition",against:"Preposition",among:"Preposition",throughout:"Preposition",despite:"Preposition",towards:"Preposition",upon:"Preposition",concerning:"Preposition",to:"Preposition",in:"Preposition",for:"Preposition",on:"Preposition",by:"Preposition",about:"Preposition",like:"Preposition",through:"Preposition",over:"Preposition",before:"Preposition",between:"Preposition",after:"Preposition",since:"Preposition",without:"Preposition",under:"Preposition",within:"Preposition",along:"Preposition",following:"Preposition",across:"Preposition",behind:"Preposition",beyond:"Preposition",plus:"Preposition",except:"Preposition",but:"Preposition",up:"Preposition",out:"Preposition",around:"Preposition",down:"Preposition",off:"Preposition",above:"Preposition",near:"Preposition",and:"Conjunction",or:"Conjunction",but:"Conjunction",so:"Conjunction",because:"Conjunction",if:"Conjunction",though:"Conjunction",although:"Conjunction",while:"Conjunction",unless:"Conjunction",since:"Conjunction",whereas:"Conjunction",whether:"Conjunction",the:"Determiner",a:"Determiner",an:"Determiner",this:"Determiner",that:"Determiner",these:"Determiner",those:"Determiner",my:"Determiner",your:"Determiner",his:"Determiner",her:"Determiner",its:"Determiner",our:"Determiner",their:"Determiner",all:"Determiner",some:"Determiner",any:"Determiner",no:"Determiner",every:"Determiner",each:"Determiner",either:"Determiner",neither:"Determiner",few:"Determiner",less:"Determiner",much:"Determiner",many:"Determiner",what:"Determiner",which:"Determiner",whose:"Determiner"};oe.as="Preposition",oe.if="Conjunction";const re={};re.number=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety","hundred","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion"],re.ordinal=["first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth","sixteenth","seventeenth","eighteenth","nineteenth","twentieth","thirtieth","fortieth","fiftieth","sixtieth","seventieth","eightieth","ninetieth","hundredth","thousandth","millionth","billionth","trillionth"],re.money={dollar:!0,cent:!0,ruble:!0,dime:!0,nickel:!0,rupee:!0,afghani:!0,euro:!0,lira:!0,yen:!0,franc:!0,yuan:!0,dinar:!0,shilling:!0,rial:!0,peso:!0,drachma:!0,dirham:!0,florin:!0,forint:!0,koruna:!0,krona:!0,kroon:!0,lats:!0,shekel:!0,won:!0,zloty:!0,pound:!0,pence:!0,penny:!0,sterling:!0,shilling:!0};let ne,ae=Object.assign({},oe,ee,se,te),ie={};for(ne in re.ordinal)ie[re.ordinal[ne]]="Ordinal";for(ne in re.number)ie[re.number[ne]]="TextValue";for(ne in re.money)ie[ne]="Money",ie[N.toPlural(ne)]="Money";const ce={};ce["#Demonym"]=["Adjective","Singular"],ce["#Noun"]=["Singular","Noun"],ce["#PresentTense"]=["PresentTense","Verb"],ce["#Infinitive"]=["Infinitive","Verb"],ce["#PastTense"]=["PastTense","Verb"],ce["#Gerund"]=["Gerund","Verb"],ce["#Adjective"]=["Adjective"];let le=["(in|for|all|to|every) #Noun$","(that|which) #Noun$","(of|in|by|for) #Gerund$"];const pe=Object.assign({},ae,ie,{a:"Determiner",an:"Determiner",the:"Determiner",and:"Conjunction",but:"Conjunction",or:"Conjunction",nor:"Conjunction","so that":"Conjunction",as:"Conjunction","if then":"Conjunction",not:"Negative",as:"Preposition",in:"Preposition",on:"Preposition",of:"Preposition",by:"Preposition",for:"Preposition",with:"Preposition",to:"Preposition",from:"Preposition",during:"Preposition",until:"Preposition",into:"Preposition",about:"Preposition",onto:"Preposition",since:"Preposition",except:"Preposition",towards:"Preposition",before:"Preposition",after:"Preposition",over:"Preposition",through:"Preposition",under:"Preposition",while:"Conjunction",though:"Conjunction",although:"Conjunction",unless:"Conjunction",because:"Conjunction",since:"Conjunction",whereas:"Conjunction",whether:"Conjunction",however:"Adverb",therefore:"Adverb",moreover:"Adverb",furthermore:"Adverb",otherwise:"Adverb",instead:"Adverb",anyway:"Adverb",somehow:"Adverb",anyhow:"Adverb",consequently:"Adverb",hence:"Adverb",thus:"Adverb",no:"Determiner",all:"Determiner",some:"Determiner",any:"Determiner",each:"Determiner",every:"Determiner",another:"Determiner",whatever:"Determiner",either:"Determiner",neither:"Determiner",enough:"Determiner",what:"QuestionWord",which:"QuestionWord",who:"QuestionWord",whom:"QuestionWord",whose:"QuestionWord",when:"QuestionWord",where:"QuestionWord",why:"QuestionWord",how:"QuestionWord",very:"Adverb",really:"Adverb",quite:"Adverb",too:"Adverb",so:"Adverb",also:"Adverb",just:"Adverb",even:"Adverb",already:"Adverb",still:"Adverb",yet:"Adverb",always:"Adverb",usually:"Adverb",often:"Adverb",sometimes:"Adverb",never:"Adverb",well:"Adverb",badly:"Adverb",slowly:"Adverb",quickly:"Adverb",carefully:"Adverb",easily:"Adverb",fast:"Adverb",hard:"Adverb",apart:"Adverb",together:"Adverb",alone:"Adverb",ago:"Adverb",abroad:"Adverb",around:"Adverb",almost:"Adverb",only:"Adverb",ever:"Adverb",away:"Adverb",back:"Adverb",forth:"Adverb",forward:"Adverb",up:"Adverb",down:"Adverb",out:"Adverb",off:"Adverb",above:"Adverb",below:"Adverb",here:"Adverb",there:"Adverb",everywhere:"Adverb",somewhere:"Adverb",anywhere:"Adverb",nowhere:"Adverb",today:"Adverb",yesterday:"Adverb",tomorrow:"Adverb",now:"Adverb",then:"Adverb",again:"Adverb",twice:"Adverb",once:"Adverb",am:"Copula",are:"Copula",is:"Copula",was:"Copula",were:"Copula",been:"Copula",being:"Copula",have:"Auxiliary",had:"Auxiliary",has:"Auxiliary",do:"Auxiliary",did:"Auxiliary",does:"Auxiliary",can:"Modal",could:"Modal",may:"Modal",might:"Modal",shall:"Modal",should:"Modal",will:"Modal",would:"Modal",must:"Modal",ought:"Modal"});var de={preTags:ce,postTags:le,lexicon:pe,patterns:{},tagSet:J};const ue={parse:function(e,t){return"string"!=typeof e?"":e.split(" ").filter(e=>e)},match:function(e,t,s,o){let r=[];if(!e||0===e.length)return[];for(let s=0;s<e.length;s+=1){let o=!0;for(let r=0;r<t.length;r+=1){let n=e[s+r];if(!n){o=!1;break}let a=t[r];if("."===a){o=!0;continue}if("string"!=typeof n.normal){o=!1;break}if("string"!=typeof a)break;if(a.startsWith("#")&&n.tags.has(a.slice(1))){o=!0;continue}if(a.startsWith("!")&&!n.tags.has(a.slice(1))){o=!0;continue}if(a.startsWith("^")&&n.word.startsWith(a.slice(1))){o=!0;continue}if(a.endsWith("$")&&n.word.endsWith(a.slice(0,-1))){o=!0;continue}let i=new RegExp(`^${a}$`);if(i.test(n.normal)){o=!0;continue}o=!1;break}if(o){let t=e.slice(s,s+t.length);r.push(t),s+=t.length-1}}return r}},he=e=>e.split("."),me={};me.split=function(e){let t=[],s=e.terms.slice(0),o=me.splitBy(s,"ClauseEnd");return o.forEach(e=>{t=t.concat(me.splitBy(e,"Verb"))}),t},me.splitBy=function(e,t){let s=[],o=0;for(let r=0;r<e.length;r++)e[r].tags.has(t)&&(s.push(e.slice(o,r+1)),o=r+1);return s.push(e.slice(o,e.length)),s.filter(e=>e.length>0)};const fe={};fe.verbs=e=>e.match("#Verb+"),fe.adj=e=>e.match("#Adjective+"),fe.adverbs=e=>e.match("#Adverb+"),fe.nouns=e=>e.match("#Noun+");const ye=(e,t)=>{let s=Object.keys(e.lexicon);for(let o=0;o<t.length;o++){let r=t[o].normal.replace(/'s$/,"");s.some(e=>new RegExp(e).test(r))&&t[o].tag("Exists","lexicon-exists")}},ge={};ge.tagSafe=e=>{let t=e.match("#Noun+");return t=t.ifNo("(someone|something|anything|everything|anyone|everybody|nobody)"),t=t.ifNo("#Pronoun"),t=t.ifNo("#Determiner"),t=t.ifNo("#Value"),t=t.ifNo("#Copula"),t=t.ifNo("#QuestionWord"),t.lastTerm().if("#Noun").tag("TagSafe","tag-safe"),t.lastTerm().if("#Person").tag("TagSafe","tag-safe"),e};var xe={};xe.firstWords=function(e){let t=e.match("^.");t.match("#ProperNoun").tag("FirstName","first-word-proper"),t.match("#Possessive").tag("Noun","first-word-possessive"),t.match("#Pronoun").tag("Noun","first-word-pronoun"),t.match("#Adjective").tag("Noun","first-word-adjective"),t.match("#Verb").tag("Noun","first-word-verb"),e.match("^#Determiner #Noun$").terms(1).tag("TagSafe","first-word-det-noun")},xe.lastWords=function(e){let t=e.match(".$");t.match("#Adjective").tag(["Adjective","TagSafe"],"last-word-adj"),t.match("#Adverb").tag(["Adverb","TagSafe"],"last-word-adv")},xe.logic=function(e){ge.tagSafe(e);let t=e.match("#Noun+");t.ifNo("#Pronoun").ifNo("(#Copula|#Negative|#Modal)").ifNo(Et.noun.before).lastTerm().tag("TagSafe","noun-tag-safe");let s=e.match("#Verb+");s=s.ifNo("#Copula"),s.ifNo("#Modal"),s.ifNo(Et.verb.before).lastTerm().tag("TagSafe","verb-tag-safe");let o=e.match("#Adjective+");o=o.ifNo(Et.adj.before).lastTerm().tag("TagSafe","adj-tag-safe")},xe.nounFallback=function(e){let t=e.match("!#Value & !#Contraction & #Noun");t.if("(#Determiner|#Adjective)").tag("TagSafe","noun-fallback-safe"),t=t.ifNo("#Noun+ #Noun+"),t=t.ifNo("^#Noun+"),t.terms(0).tag("Noun","noun-fallback")},xe.misc=e=>{e.match("#Verb not").tag("Negative","vb-not"),e.match("not #Adverb? #Adjective").tag("Negative","not-adj"),e.match("not #Adverb? #Verb").tag("Negative","not-verb"),e.match("(a|an) #Adjective+ #Noun").ifNo("#Date").tag("NounPhrase","a-adj-noun"),e.match("#Adjective+ #Noun").ifNo("#Date").tag("NounPhrase","adj-noun")};var be={};be.phrasal=function(e){e.match("#Verb #Particle").tag("PhrasalVerb","phrasal-verb")},be.progressive=function(e){let t=e.match("(is|was|were) #Adverb? [#Gerund]");t.found&&t.not("(#Adjective|#Noun)").tag("Progressive","is-gerund")},be.do=function(e){e.match("(do|does|did) not #Adverb? [#Infinitive]").tag("Verb","do-not-verb")},be.passive=function(e){e.match("#Copula #Adverb? #PastTense").ifNo("(#Gerund|#Adjective)").tag("Passive","is-past")},be.perfect=function(e){let t=e.match("(have|has) #Adverb? #PastTense");t.ifNo("#Gerund").tag("PerfectTense","have-past"),t=e.match("(#Copula) #Adverb? been #Adverb? #PastTense"),t.ifNo("#Gerund").tag("PerfectTense","been-past")},be.future=function(e){e.match("will #Adverb? #Infinitive").tag("FutureTense","will-verb"),e.match("will have #PastTense").tag("FutureTense","will-have-pst")};const Ce={};Ce.noun=e=>e.match("#Noun+ #Preposition ."),Ce.verb=e=>{let t=e.match("#Verb+ #Adverb? #Preposition ."),s=t.match("#Verb #Adverb? (#Preposition|#Conjunction) (us|it|him|her|them)");return s.found||t.match("#Verb #Adverb? #Preposition (#Determiner|#Adjective|#Noun)")},Ce.adj=e=>e.match("#Adjective+ #Preposition .");const ve=(e,t,s)=>{let o=Object.assign({word:!1,case:!1,punctuation:!1,whitespace:!1},s);return e.reduce((e,s,r)=>{let n=s.word,a=s.pre,i=s.post;if(t&&t.terms&&t.terms[r]&&(t.terms[r].pre&&(a=t.terms[r].pre),t.terms[r].post&&(i=t.terms[r].post)),!o.case&&/[A-Z]/.test(n)&&(n=n.toLowerCase()),o.word){let e=t.terms[r]&&t.terms[r].word;e&&(n=e)}o.case&&t.terms[r]&&t.terms[r].case&&"title"===t.terms[r].case&&(n=n.replace(/./,e=>e.toUpperCase())),o.punctuation||(i=i.replace(/[.,?]/,""));let c=a+n;return o.whitespace||(c=c.trim()),c+=" ",o.whitespace||(c+=i),c=c.replace(/ +/g," "),e+c},"")};const we={};we.insert=function(e,t,s){let o=ve(e,{},{whitespace:!0}),r=[],n=o.split(" ");return n.forEach((e,o)=>{r.push(e),o===t-1&&("string"==typeof s?r.push(s):r.push(ve(s.termList(),{},{whitespace:!0})))})},we.replace=function(e,t,s,o){o=o||"";let r=ve(e.termList()),n=ve(t.termList());s&&(n=ve(s.termList()));let a=new RegExp(`\\b${n}\\b`,"g");return r.replace(a,o)},we.delete=function(e,t){let s=ve(e.termList()),o=ve(t.termList());o=o.trim();let r=new RegExp(`\\b${o}\\b`,"g");return s.replace(r,"").replace(/ +/g," ").trim()},we.prepend=function(e,t){let s=ve(e.termList());return s=t.trim()+" "+s,s.trim()},we.append=function(e,t){let s=ve(e.termList());return s=s.trim()+" "+t.trim(),s.trim()};var Te={noun:{plural:e=>e.map(e=>N.toPlural(e)),singular:e=>e.map(e=>N.toSingular(e))},verb:{toPresent:e=>e.map(e=>V.toPresentTense(e)),toPast:e=>e.map(e=>V.toPastTense(e)),toGerund:e=>e.map(e=>V.toGerund(e))},adj:{toComparative:e=>e,toSuperlative:e=>e}};const Oe={one:{tokenize:he,contractions:Object.assign(Xt.contractions,Xt.honorifics)},two:{normalize:Zt.normalize,conjugations:Jt.conjugations,plurals:Jt.plurals,findRoot:Qt.findRoot},three:{lexicon:{},frozen:{}},methods:{one:{tokenize:he,match:ue.match,parse:ue.parse},two:{getNoun:fe.nouns,getVerb:fe.verbs},three:{toText:ve}},compute:{preTagger:Ht.preTagger,postTagger:Ht.postTroller,lexicon:new Lt.prototype.lexicon,phraser:Ht.phraser,normal:new Lt.prototype.normal,fallback:new Lt.prototype.fallback,contractions:function(){}}};var Se=Object.assign({},it,at,nt,bt,{fromJSON:function(e){this.docs=JSON.parse(e)},compute:function(e){return Bt.compute(e,this.world),this},tag:function(e,t){return st(this,e,t),this},unTag:function(e,t){this.list.forEach(t=>t.unTag(e)),this.compute("lexicon"),this.compute("normalize");for(let s=0;s<this.world.hooks.length;s++)this.world.hooks[s](e,this);return this},canBe:function(e){return this.match(e).found},terms:function(e){let t=this.termList();return"number"==typeof e?this.from(t[e]):this.from(t)},termList:it.termList,words:function(){return this.terms()},clauses:function(e){return this.match("#Clause+").get(e)},parent:function(){let e=this.fullSentence();return e.found?e:this.all()},parents:it.parents,parentheses:function(e){return this.match("#Parentheses").get(e)},fullSentence:function(){if(!this.docs[0])return this.none();let e=this.docs[0][0].doc;if(!e||!e.parent)return this.none();if(e.parent.isA("Sentence"))return e.parent;let t=e.parent.parent;return t&&t.isA("Sentence")?t:this.none()},is:yt,has:function(e){return this.match(e).found},if:function(e){return this.match(e).found?this:this.none()},ifNo:function(e){return this.match(e).found?this.none():this},before:function(e){e=Rt(e,this.all());let t=this.termList();if(0===t.length||0===e.length)return this.none();let s=e.docs[0][0];return this.all().before(s)},after:function(e){e=Rt(e,this.all());let t=this.termList();if(0===t.length||0===e.length)return this.none();let s=e.docs[e.docs.length-1];s=s[s.length-1];let o=this.all().after(s);return o},remove:function(e){e=Ft(e);let t=this.all();return e.forEach(e=>{let s=t.match(e);s.found&&s.forEach(e=>{e.docs=e.docs.map(e=>({start:e[0].start,length:e.length}))})}),t},matchOne:function(e){return this.match(e,0)},splitAfter:function(e){let t=this.match(e);return this.splitOn(t,"after")},splitBefore:function(e){let t=this.match(e);return this.splitOn(t,"before")},splitOn:function(e){return this.list.map(t=>t.splitOn(e))},toUpperCase:function(){return this.list.forEach(e=>e.toUpperCase()),this},toLowerCase:function(){return this.list.forEach(e=>e.toLowerCase()),this},toTitleCase:function(){return this.list.forEach(e=>e.toTitleCase()),this},toCamelCase:function(){return this.list.forEach(e=>e.toCamelCase()),this},toQuotations:function(){return this.parentheses().toQuotation()},toParentheses:function(){return this.quotations().toParentheses()},unique:function(){let e=[];return this.list.forEach(t=>{let s=!1;e.forEach(e=>e.out("normal")===t.out("normal")&&(s=!0)),1==!s&&e.push(t)}),this.from(e)},adjectives:function(){return this.match("#Adjective")},conjunctions:function(){return this.match("#Conjunction")},prepositions:function(){return this.match("#Preposition")},determiners:function(){return this.match("#Determiner")},verbs:function(){return this.match("#Verb")},nouns:function(){return this.match("#Noun")},pronouns:function(){return this.match("#Pronoun")},adverbs:function(){return this.match("#Adverb")},values:function(){return this.match("#Value")},symbols:function(){return this.match("#Symbol")},text:function(e){return this.list.map(t=>t.text(e)).join(" ")},out:function(e,t){return e=e||"text","terms"===e?this.termList().map(e=>e.json(t)):"array"===e?this.list.map(t=>t.text()):"json"===e?this.list.map(s=>s.json(t)):this.text()},debug:function(){let e=this;e.list.forEach(t=>{let s=t.terms().map(e=>e.word).join(" ");console.log(`\n\n== '${s}' ==`),t.terms().forEach(e=>{console.log(`  - '${e.word}'`),console.log("    ",e.tags)})}),console.log("\n")},offset:function(){let e=this.termList();if(!e.length)return[];let t=e[0].offset.start,s=e[e.length-1].offset,o=s.start+s.length-t;return[{start:t,length:o,text:this.text()}]},wordCount:function(){return this.terms().length},replaceWith:function(e,t){let s=this.match(e),o=this.all();return s.forEach(e=>o.replace(e,t)),o},replace:function(e,t){let s,o,r=this.all();if("object"==typeof e&&e.isA?(s=e.termList(),o=t):"string"==typeof e&&(s=this.match(e).termList(),o=t),!s)return this;let n=this.all();return s.forEach(e=>{let t=n.list.find(t=>t.docs[0][0].id===e.id);t&&t.replaceWith(o)}),n},delete:function(e){e=e||this;let t=this.all();return t.replace(e,"")},preprend:function(e){let t=this.all();return t.list.forEach(t=>t.prepend(e)),t},append:function(e){let t=this.all();return t.list.forEach(t=>t.append(e)),t},ltrim:function(){let e=this.all(),t=e.list[0];return t.docs.forEach(e=>e[0].pre=""),e},rtrim:function(){let e=this.all(),t=e.list[0];return t.docs.forEach(s=>s[s.length-1].post=" "),e},trim:function(){return this.ltrim().rtrim()}});Se.isPolite=function(){let e=this.match("(please|thank you|thanks)");return e.found};var ke={one:Object.assign({},Yt,{lexicon:Object.assign({},Xt.lexicon,de.lexicon),patterns:Object.assign({},de.patterns),preTags:Object.assign({},Yt.preTags,de.preTags,ce),postTags:Object.assign({},de.postTags,le),tagSet:Object.assign({},de.tagSet,J)}),two:Object.assign({},Qt,{normalize:Object.assign({},Zt.normalize,Xt.normalize),plurals:Object.assign({},S.plural,c),conjugations:Object.assign({},V,{irregulars:se})}),three:{},methods:{one:{tokenize:he,contractions:Object.assign(Xt.contractions,Xt.honorifics)},two:{getNoun:fe.nouns,getVerb:fe.verbs,findRoot:Qt.findRoot},three:{toText:ve}},compute:{preTagger:Ht.preTagger,postTagger:Ht.postTroller,lexicon:new Lt().lexicon,phraser:Ht.phraser,normal:new Lt().normal,fallback:new Lt().fallback,contractions:new Lt().contraction},hooks:[],lib:{preTagger:Nt.preTagger,postTagger:Nt.postTroller,phraser:zt},model:ke,methods:Se,api:nt},De=function(e){this.world=e,this.methods=e.methods,this.model=e.model};De.prototype.match=function(e,t){let s=[];return t.list.forEach(t=>{let o=this.matchDoc(e,t.docs[0]);s=s.concat(o)}),new this.View(s,t)},De.prototype.matchDoc=function(e,t){if("string"==typeof e)return ue.match(t,ue.parse(e));if("object"==typeof e){if(e.isA){let s=e.docs[0]||[],o=s[0]?s[0].start:null,r=s[s.length-1]?s[s.length-1].start:null;if(null!==o&&null!==r){let e=t.slice(o,r+1);return[e]}}return e.docs}return[]},De.prototype.first=function(){return this},De.prototype.last=function(){return this},De.prototype.View=Kt,De.prototype.Term=I,De.prototype.Pool=function(){this.lexicon={}};var Le=De;const Ne={one:{match:(e,t)=>{let s=t.match(e);return s},splitAfter:(e,t)=>{let s=t.splitAfter(e);return s},not:(e,t)=>{let s=t.not(e);return s},lookup:function(e,t){let s=Object.keys(t.world.lexicon);return e.docs.map(e=>e.filter(e=>s.includes(e.normal)))},adjectives:{conjugate:e=>e},verbs:{conjugate:e=>e},nouns:{conjugate:e=>e}},two:{},three:{stats:e=>{let t={terms:e.terms().length,chars:e.text().length};return t.words=t.terms,t}}};const Ie={tag:{Noun:(e,t)=>{e.match(t).tag("Noun","manual-tag")},Verb:(e,t)=>{e.match(t).tag("Verb","manual-tag")},Adjective:(e,t)=>{e.match(t).tag("Adjective","manual-tag")}},unTag:{Noun:(e,t)=>{e.match(t).unTag("Noun","manual-untag")},Verb:(e,t)=>{e.match(t).unTag("Verb","manual-untag")},Adjective:(e,t)=>{e.match(t).unTag("Adjective","manual-untag")}}},Ae={},Pe=e=>null!==e&&"object"==typeof e&&!0===e.isA,Me={};Me.find=function(e){let t,s=this;for(;!t&&s;){if(e(s))return s;s=s.parent}return null},Me.fullSentence=function(){return this.find(e=>"Sentence"===e.isA)},Me.isA=function(e){return this.constructor.name===e};var Fe={Term:function(){this.isA="Term",this._text="",this._normal="",this._tags={},this._pre="",this._post="",this.dirty=!1},Phrase:function(){this.isA="Phrase",this.terms=[]},Sentence:function(){this.isA="Sentence",this.start=0,this.length=0,this.phrases=[]},Doc:function(){this.parent=null,this.isA="Doc",this.sentences=[]},Pool:function(){this.isA="Pool",this.lexicon={},this.cache={}}};Fe.Term.prototype={text:function(e){return void 0===e?this._text:(this._text=e,this)},normal:function(e){return void 0===e?this._normal:(this._normal=e,this)},tags:function(){return Object.keys(this._tags)},hasTag:function(e){return!0==this._tags[e]},addTag:function(e){return this._tags[e]=!0,this},rmTag:function(e){return delete this._tags[e],this}},Fe.Phrase.prototype={text:function(){return this.terms.reduce((e,t)=>e+t.text(),"")}},Fe.Sentence.prototype={phrases:function(e){return void 0===e?this.phrases:(this.phrases=e,this)},text:function(){return this.phrases.reduce((e,t)=>e+t.text(),"")}},Fe.Doc.prototype={sentences:function(e){return void 0===e?this.sentences:(this.sentences=e,this)},text:function(){return this.sentences.reduce((e,t)=>e+t.text(),"")}};const Re={plugin:function(e,t){return"string"==typeof e&&"object"==typeof t&&(e={model:{"-":e},api:t}),e.api&&(this.api=Object.assign(this.api,e.api)),e.model&&this.addWords(e.model),e.tags&&this.addTags(e.tags),e.regex&&this.addPatterns(e.regex),e.plurals&&this.addPlurals(e.plurals),this.compute(),this}};const Ee=(e,t)=>{for(let s in t)e[s]||(e[s]=t[s])},ze={},Ue=(e,t)=>{let s,o,r,n;for(o=e.length-1;o>=0;o--)for(s=e[o],r=s.length-1;r>=0;r--)for(n=t.length-1;n>=0;n--)s[r].has(t[n].tag)&&s.match(t[n].match,`${t[n].tag}-phrase`).tag(t[n].tag)},Be=(e,t)=>{let s,o,r,n;for(o=e.length-1;o>=0;o--)for(s=e[o],r=s.length-1;r>=0;r--)for(n=t.length-1;n>=0;n--)s[r].has(t[n].tag)&&(s[r].parent.match(t[n].match).tag(t[n].tag),r=0)};const Ke=["Copula","Noun","Adjective","Verb","Adverb"],Ge={};Object.keys(Ke).forEach(e=>{let t=Ke[e];Ge[t]=function(e){return this.match(e).tag(t,"lexicon-phrase")}});const We=(e,t)=>{let s={};return e.forEach(e=>{let o,r=e.normal;t.hasOwnProperty(r)&&(o=t[r]),r.length>5&&Object.keys(t).find(e=>{if(r.endsWith(e)){let s=r.substr(0,r.length-e.length);return!!this.world.lexicon[s]&&(o=t[e],!0)}}),o&&e.tag(o,`${o}-suffix`)})}return s};const $e={},Ve=(e,t)=>{for(let s in t)e.has(s)&&e.tag(t[s],s)};$e.start_rules=e=>{let t={"^#Determiner":"Determiner","^#Adverb":"Verb","^#QuestionWord":"Question"}},$e.end_rules=e=>{"$.":{Period:!0},"$?":{QuestionMark:!0},"$!":{ExclamationMark:!0}},$e.noun_fallback=e=>e.ifNo("#Value, #Verb, #Adjective, #QuestionWord, #Conjunction, #Preposition, #Expression").tag("Noun","noun_fallback"),$e.proper_nouns=e=>e.match("#TitleCase+").ifNo("#Month").ifNo("#WeekDay").tag("#ProperNoun"),$e.people=e=>e.match("#FirstName #LastName"),$e.places=e=>{e.match("#City, #Region"),e.match("#City, #Country"),e.match("#Noun+ (farm|road|county|province|state|suburb|neighbourhood|land|village|town|city|country|continent)")};const je={};je.tense=e=>{e.match("(#PastTense|#PresentTense) and #Verb").lastTerm().tag("PresentTense","conj-verb")};const qe={};qe.verbs=e=>e.match("#Adverb+? #Verb #Adverb+?").tag("VerbPhrase","adv-verb"),qe.nouns=e=>e.match("#Adjective+ #Noun").ifNo("#Pronoun").tag("NounPhrase","adj-noun"),qe.values=e=>e.match("#Value #Unit?").tag("ValuePhrase"),qe.clauses=e=>{let t=e.match("[#Verb] #Noun+ #Adverb*");t.if("#Copula").tag("Clause","copula-noun"),t=e.match("#Noun #Adverb* #Verb+ #Adverb*"),t.ifNo("#Copula").tag("Clause","noun-verb")},je.contractions=(e,t)=>{for(let s=0;s<e.length;s++){let o=e[s];t.hasOwnProperty(o.normal)&&(o.insertAfter(t[o.normal]),o.delete(),e.splice(s,1))}return e};const He=(e,t)=>{let s,o,r,n,a,i;const c=(e,t,s,o,r)=>{let n=e.slice(t,s);n=new e.constructor(n);let a=o.map(e=>e(n,r));for(a=a.filter(e=>e),i=0;i<a.length;i++)n.tag(a[i])};for(s=0;s<e.length;s++){let l=e[s];if(!1!==l.dirty){for(l.terms.forEach(e=>e.tags={}),o=0;o<t.length;o++){let s=t[o];"function"==typeof s?s(l):"object"==typeof s&&Object.keys(s).forEach(e=>{l.match(e).tag(s[e],`object-rule:${e}`)})}for(a=0;a<l.length;a++)for(n=0;n<l.length-a;n++)r=n+a,c(l.terms,n,r+1,l.world.latent_rules,l);l.dirty=!1}}return e},Ze={contractions:{},suffix_rules:{},first_pass:function(e){$e.proper_nouns(e)},fix:function(e){}},Je={lexicon:{},rules:{}},Qe={},Xe={},Ye={lexicon:{}},et={},tt={};let st={};const ot={fns:{},methods:{},models:{},api:function(e){this.isA="Doc",this._parent=e,this.list=this.docs.map(t=>new this.Sentence(t,this))},Term:I,Phrase:function(){},Sentence:function(e,t){this._parent=t,this.terms=e}},rt={};const nt=function(e,t,s,o){this.word=e||"",this.normal=s||"",this.tags=new Set(t||[]),this.whitespace={pre:" ",post:""},this.implicit=o||""};nt.prototype.json=function(e){let t={text:this.word};if(e.normal&&(t.normal=this.normal),e.tags&&(t.tags=Array.from(this.tags)),e.implicit&&this.implicit&&(t.implicit=this.implicit),e.whitespace){t.pre=this.whitespace.pre,t.post=this.whitespace.post;let s=this.word.trim();s.length<this.word.length&&!s&&(t.silent_term=!0)}if(e.offset){t.offset=this.offset;let s=this.word.trim();s.length<this.word.length&&!s&&(t.silent_term=!0)}return t},nt.prototype.clone=function(){let e=new nt(this.word,Array.from(this.tags),this.normal,this.implicit);return e.whitespace=Object.assign({},this.whitespace),e};const at=(e,t)=>{if(!e)return[];let s=e.split(/(\S+)/);s=s.filter(e=>e);for(let e=0;e<s.length;e+=1){let o=s[e],r=ie.exec(o),n=ce.exec(o);if(o.length>1&&!le.test(o)){let a=j.test(o),i=X.test(o),c=pe.test(o);a?s.splice(e+1,0,"!"):i?s.splice(e+1,0,"?"):c?function(e,t,s){let o=e.split(pe);o[0]&&o[1]&&(t.splice(s,1,o[0],"-",o[1]),o=null)}(o,s,e):function(e,t,s,o){let r,n,a,i=o.prePunctuation,c=o.postPunctuation,l=o.contractions;if(r=i[e[0]])return t[s]=e.substr(1),void t.unshift(r);if(n=c[e[e.length-1]])return t[s]=e.substr(0,e.length-1),void t.push(n);if(a=e.match(de))return l.hasOwnProperty(a[2])?(t[s]=a[1],void t.splice(s+1,0,l[a[2]])):void(t[s]=a[1])}(o,s,e,t),r&&s.splice(e,0,"'"),n&&s.splice(e,0,'"')}}s=s.filter(e=>e);let o=[];s.forEach(e=>{let t=!1;e.length>2&&Object.keys(d).forEach(s=>{e.endsWith(s)&&(o.push(e.replace(new RegExp(s+"$"),"")),o.push(s),t=!0)}),t||o.push(e)});let r=o.map(e=>new nt(e));for(let e=0;e<r.length-1;e++)if(t.honorifics[r[e].word.toLowerCase().replace(/\./g,"")])return r[e].word=r[e].word+r[e+1].word,r[e+1].word="",r=r.filter(e=>e.word),r;return r.filter(e=>e.word)},it=function(e,t){let s=Object.assign({},this.pointer);o=Object.assign({},t,{pointer:s})},ct=(e,t)=>{let s=0;const o=()=>{if(s>=e.length)return null;let o=e[s];s+=1,o.forEach((e,s)=>{let r=t.length;e.offset={index:r,start:t.length,length:e.word.length},e.id=`${o.uuid}-${s}`,t.push(e)});let r=o.length;if(s<e.length&&!o.post&&r>0){let e=t[t.length-1];e.word&&(e.post=""),o.post=""}return r>0?r:o()};return o()},lt={pre:"",post:" ",honorifics:{mr:!0,mrs:!0,ms:!0,dr:!0,sr:!0,jr:!0,sgt:!0,capt:!0,prof:!0,esq:!0,gov:!0,rev:!0,st:!0,inc:!0,corp:!0,ltd:!0},prePunctuation:{"'":!0,'"':!0,"(":!0,"[":!0,"#":!0},postPunctuation:{".":!0,",":!0,";":!0,":":!0,"?":!0,"!":!0,")":!0,"]":!0},contractions:{re:"are",ve:"have",ll:"will",d:"would",m:"am",s:"is"}},pt={};pt.split=function(e){this.docs=e.docs.map(t=>{let s=at(t[0].word,lt);return s.forEach((e,s)=>{t[s]=e}),t.length=s.length,t});let t=ct(this.docs,this.terms);null!==t&&this.compute(["lexicon","preTagger"])};const dt={},ut=(e,t)=>{const s=function(e,t){return e.docs.map(e=>e.filter(e=>t.test(e.normal)))};return{match:t=>s(e,new RegExp(`^${t}$`,"i")),startsWith:t=>s(e,new RegExp(`^${t}`,"i")),endsWith:t=>s(e,new RegExp(`${t}$`,"i")),not:t=>{let o=s(e,new RegExp(`${t}`,"i")),r=[],n={};return o.forEach(e=>{e.forEach(e=>{n[e.id]=!0})}),e.docs.map(e=>e.filter(e=>!n[e.id]))}},ht={};ht.find=function(){return this.from(this.docs[0])},ht.first=function(){return this.from(this.docs[0])},ht.last=function(){return this.from(this.docs[this.docs.length-1])},ht.all=function(){return this.from(this.docs)},ht.get=function(e){if(void 0===e)return this.from(this.docs);if("number"==typeof e){let t=e;return t<0&&(t=this.docs.length+t),this.from(this.docs[t])}if("string"==typeof e)return ut(this,e);let t=ut(this,".");return t.match=e=>[],t.not=e=>[],t.startsWith=e=>[],t.endsWith=e=>[],t.if=e=>[],t.ifNo=e=>[],t.has=e=>[],t},ht.eq=ht.get,ht.text=function(e){return this.docs.map(t=>t.reduce((t,s)=>{let o=s.word,r=s.whitespace.pre||"",n=s.whitespace.post||"";e&&"root"===e&&(o=this.methods.two.findRoot(s,this.world));let a=r+o+n;return t+a},"")).join("")},ht.json=function(e){return this.docs.map(t=>t.map(t=>t.json(e)))},ht.terms=function(){let e=[];return this.docs.forEach(t=>{e=e.concat(t)}),this.from(e)},ht.is=function(e){return this.match(e).found},ht.if=function(e){return this.match(e).found?this:this.none()},ht.ifNo=function(e){return this.match(e).found?this.none():this},ht.has=function(e){return this.match(e).found};const mt={version:"14.11.0"},ft=function(e,t){const s={version:mt.version,model:{one:de,two:Qt,three:{}},methods:{one:ue,two:{},three:vt},compute:{preTagger:Nt.preTagger,postTagger:Nt.postTroller,lexicon:new Lt().lexicon,phraser:Ht.phraser,normal:new Lt().normal,fallback:new Lt().fallback,contractions:new Lt().contraction},hooks:[],lib:{preTagger:Nt.preTagger,postTroller:Nt.postTroller,phraser:zt},api:ht,fns:{}};let o,r=function(e,t){let n={};o.forEach(t=>{n[t]=e[t]}),s.methods.one.tokenize=at;let a=new Kt(e,void 0,s,t);return a.world=s,a.methods=Se,a.compute(),a};o=Object.keys(ht);let n=Object.keys(Se);for(o=o.concat(n),o=o.filter(e=>"world"!==e&&"methods"!==e&&"compute"!==e),o=new Set(o),o=Array.from(o),e=e||"";let a=0;a<s.hooks.length;a+=1)s.hooks[a](e,r);let i=at(e,s.methods.one.contractions);i.forEach(e=>{e.tags.size>0&&e.tags.forEach(t=>{s.model.one.tagSet[t]||(s.model.one.tagSet[t]={})})});let c=[i];return c[0].uuid=Math.random().toString().slice(2,11),r(c)};return ft.plugin=function(e){const t=(e,t)=>{Object.keys(t).forEach(s=>{e.hasOwnProperty(s)?Object.assign(e[s],t[s]):e[s]=t[s]})};let s=ft("",null);s.world.plugin(e,Kt),ft.world=s.world},ft.world={},ft.version=mt.version,ft.tokenize=function(e,t){let s=new Kt([],null,t||{});return s.docs=[at(e,s.world.methods.one.contractions)],s},ft.addTags=$t.addTags,ft.addWords=$t.addWords,ft.verbose=function(e){!1===e?this.world.verbose=!1:this.world.verbose="short"},ft}));</script>

    <script>
        // A palette of distinct, pleasant background colors for highlighting
        const HIGHLIGHT_COLORS = [
            '#fdba74', '#a5b4fc', '#6ee7b7', '#fca5a5', '#93c5fd',
            '#d8b4fe', '#fde047', '#a7f3d0', '#f9a8d4',
        ];
        
        // Wait for the entire page to load to ensure the embedded library is ready.
        window.onload = function() {
            const analyzeBtn = document.getElementById('analyze-btn');
            // Check if the compromise library has been loaded successfully
            if (typeof window.compromise === 'function') {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyze and Highlight Names';
                analyzeBtn.classList.remove('bg-indigo-400', 'cursor-not-allowed');
                analyzeBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            } else {
                // This case should not be reached now that the library is embedded.
                console.error("Failed to load the compromise.js library.");
                analyzeBtn.textContent = 'Error: Failed to load model';
                analyzeBtn.classList.add('bg-red-500'); 
            }
        };


        /**
         * Escapes special characters in a string for use in a regular expression.
         * @param {string} str The string to escape.
         * @returns {string} The escaped string.
         */
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        /**
         * Escapes HTML special characters to prevent them from being interpreted as HTML.
         * @param {string} str The string to escape.
         * @returns {string} The escaped string.
         */
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

        /**
         * Main function to process the input text and generate highlighted HTML output.
         */
        function processText() {
            const inputText = document.getElementById('inputText').value;
            if (!inputText.trim()) {
                document.getElementById('output').textContent = "Please paste some text into the input box first.";
                document.getElementById('results-container').classList.remove('hidden');
                document.getElementById('legend').innerHTML = '';
                return;
            }
            
            // Use compromise.js to find people's names.
            const doc = window.compromise(inputText);
            
            // Start with all entities the library thinks are people.
            let people = doc.people();

            // Explicitly remove any entities that are also tagged as organizations or places.
            const organizations = doc.organizations();
            const places = doc.places();
            people = people.not(organizations);
            people = people.not(places);
            
            // Remove some other known non-person proper nouns to further refine the results.
            people = people.not('(indian uprising|international distress coupon|abraham lincoln brigade|clemency committee|emery roth and sons)');
            
            const uniqueFullNames = [...new Set(people.out('array'))];


            if (uniqueFullNames.length === 0) {
                document.getElementById('output').textContent = "The NER model did not find any names in the text.";
                document.getElementById('results-container').classList.remove('hidden');
                document.getElementById('legend').innerHTML = '';
                return;
            }

            // --- Data Preparation ---
            const personData = new Map();
            const termToFullNameMap = new Map();
            const searchTerms = [];
            const lastNameCounts = new Map();

            // First, count occurrences of each last name to identify conflicts.
            uniqueFullNames.forEach(name => {
                const parts = name.split(/\s+/);
                const lastName = parts[parts.length - 1];
                lastNameCounts.set(lastName, (lastNameCounts.get(lastName) || 0) + 1);
            });

            // Build data structures for replacement.
            let legendHtml = '';
            uniqueFullNames.forEach((fullName, index) => {
                const parts = fullName.split(/\s+/);
                const lastName = parts[parts.length - 1];
                const color = HIGHLIGHT_COLORS[index % HIGHLIGHT_COLORS.length];
                const isLastNameUnique = lastNameCounts.get(lastName) === 1;

                personData.set(fullName, { lastName, color, isLastNameUnique, firstUseFound: false });
                
                termToFullNameMap.set(fullName, fullName);
                searchTerms.push(fullName);

                if (isLastNameUnique) {
                    termToFullNameMap.set(lastName, fullName);
                    searchTerms.push(lastName);
                }
                
                // Add person to legend
                legendHtml += `<span class="name-highlight" style="background-color: ${color};">${escapeHtml(fullName)}</span>`;
            });

            // Sort terms by length descending to match "John Smith" before "Smith".
            searchTerms.sort((a, b) => b.length - a.length);

            const combinedRegex = new RegExp(`\\b(${searchTerms.map(escapeRegex).join('|')})\\b`, 'g');
            
            // --- HTML Generation ---
            let outputHtml = '';
            let lastIndex = 0;
            let result;

            while ((result = combinedRegex.exec(inputText)) !== null) {
                const matchedTerm = result[0];
                
                // Append the text between the last match and this one
                outputHtml += escapeHtml(inputText.substring(lastIndex, result.index));
                
                const fullName = termToFullNameMap.get(matchedTerm);
                
                // If the term isn't a known full name or unique last name, skip it.
                if (!fullName) {
                    outputHtml += escapeHtml(matchedTerm);
                    lastIndex = result.index + matchedTerm.length;
                    continue;
                }

                const person = personData.get(fullName);

                // Case 1: First use of the full name. Highlight and bold.
                if (matchedTerm === fullName && !person.firstUseFound) {
                    outputHtml += `<span class="name-highlight font-bold" style="background-color: ${person.color};">${escapeHtml(matchedTerm)}</span>`;
                    person.firstUseFound = true; // Mark as found
                } 
                // Case 2: Subsequent use of a unique last name. Highlight only.
                else if (person.isLastNameUnique && matchedTerm === person.lastName && person.firstUseFound) {
                     outputHtml += `<span class="name-highlight" style="background-color: ${person.color};">${escapeHtml(matchedTerm)}</span>`;
                }
                // Case 3: Any other match (e.g., repeated full name, non-unique last name) is rendered as plain text.
                else {
                    outputHtml += escapeHtml(matchedTerm);
                }
                
                lastIndex = result.index + matchedTerm.length;
            }

            // Append any remaining text after the last match.
            outputHtml += escapeHtml(inputText.substring(lastIndex));

            // Display the results.
            document.getElementById('output').innerHTML = outputHtml;
            document.getElementById('legend').innerHTML = legendHtml;
            document.getElementById('results-container').classList.remove('hidden');
        }
    </script>
</body>
</html>
